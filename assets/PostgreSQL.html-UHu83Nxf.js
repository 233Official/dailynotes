import{_ as p}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,a as n,d,e as i,r as o,o as g,f as e,b as s}from"./app-CFt4SMiv.js";const c={};function u(m,t){const r=o("Tabs");return g(),h("div",null,[t[6]||(t[6]=n('<h1 id="postgresql" tabindex="-1"><a class="header-anchor" href="#postgresql"><span>PostgreSQL</span></a></h1><ul><li><a href="#postgresql">PostgreSQL</a><ul><li><a href="#%E5%AE%89%E8%A3%85">安装</a></li><li><a href="#%E8%AE%BE%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE">设置远程访问</a></li><li><a href="#%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C">基础操作</a></li><li><a href="#sqlalchemy%E6%93%8D%E4%BD%9C">sqlalchemy操作</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8C%E6%AD%A5">数据库同步</a><ul><li><a href="#%E9%80%BB%E8%BE%91%E5%A4%8D%E5%88%B6">逻辑复制</a></li></ul></li></ul></li></ul><hr><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2>',4)),d(r,{id:"48",data:[{id:"Ubuntu"},{id:"macOS"},{id:"WIndows"}],active:0},{title0:i(({value:l,isActive:a})=>t[0]||(t[0]=[e("Ubuntu")])),title1:i(({value:l,isActive:a})=>t[1]||(t[1]=[e("macOS")])),title2:i(({value:l,isActive:a})=>t[2]||(t[2]=[e("WIndows")])),tab0:i(({value:l,isActive:a})=>t[3]||(t[3]=[s("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 更新软件包列表")]),e(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sudo"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," apt"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," update")]),e(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 安装PostgreSQL")]),e(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sudo"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," apt"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," install"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," postgresql"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," postgresql-contrib")]),e(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 安装完成后，PostgreSQL 服务将自动启动。你可以通过以下命令检查它是否正在运行")]),e(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sudo"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," systemctl"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," status"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," postgresql")]),e(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 安装完成后，默认情况下会创建一个名为postgres的系统用户，该用户拥有对PostgreSQL服务器的超级用户权限。你可以切换到该用户并使用以下命令进入PostgreSQL命令行界面,可以通过 \\q 回车退出")]),e(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sudo"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -i"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -u"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," postgres")]),e(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"psql")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),s("ul",null,[s("li",null,[s("code",null,"postgresql-contrib"),e(" 是 PostgreSQL 数据库的一个附加包，包含了一些附加功能和扩展模块，可以增强 PostgreSQL 的功能。这些功能可能包括各种数据类型、函数、插件等，可以用于处理更复杂的数据库需求或提供额外的功能。")])],-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202404081648820.png",alt:"image-20240408164820725"})],-1),s("hr",null,null,-1)])),tab1:i(({value:l,isActive:a})=>t[4]||(t[4]=[s("p",null,[e("可以直接使用 "),s("a",{href:"https://postgresapp.com/downloads.html",target:"_blank",rel:"noopener noreferrer"},"postgresapp官网"),e(" 提供的 macOS 安装包进行安装")],-1),s("p",null,"打开后左下角新建新的 Server 可以指定 Data Directory，可以指定到外接硬盘上",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505221458053.png",alt:"image-20250522145812210"})],-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505221459599.png",alt:"image-20250522145953466"})],-1),s("p",null,[e("然后点击 "),s("code",null,"Initialize"),e(" 初始化：")],-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505221500162.png",alt:"image-20250522150013065"})],-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505221500970.png",alt:"image-20250522150021912"})],-1),s("p",null,"安装完成后默认配置如下：",-1),s("table",null,[s("thead",null,[s("tr",null,[s("th",{style:{"text-align":"center"}},"Host"),s("th",{style:{"text-align":"center"}},"localhost")])]),s("tbody",null,[s("tr",null,[s("td",{style:{"text-align":"center"}},"Port"),s("td",{style:{"text-align":"center"}},"5432")]),s("tr",null,[s("td",{style:{"text-align":"center"}},"User"),s("td",{style:{"text-align":"center"}},"your system user name")]),s("tr",null,[s("td",{style:{"text-align":"center"}},"Database"),s("td",{style:{"text-align":"center"}},"same as user")]),s("tr",null,[s("td",{style:{"text-align":"center"}},"Password"),s("td",{style:{"text-align":"center"}},"none")]),s("tr",null,[s("td",{style:{"text-align":"center"}},"Connection URL"),s("td",{style:{"text-align":"center"}},"postgresql://localhost")])])],-1),s("hr",null,null,-1),s("p",null,"添加命令行工具到 PATH 方便在 zsh 中使用：",-1),s("p",null,[e("编辑 "),s("code",null,"~/.zshrc")],-1),s("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#E45649","--shiki-dark":"#E06C75"}},"PostgreSQLPath"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#56B6C2"}},"="),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},'"/Applications/Postgres.app/Contents/Versions/latest/bin"')]),e(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"export"),s("span",{style:{"--shiki-light":"#E45649","--shiki-dark":"#E06C75"}}," PATH"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#56B6C2"}},"="),s("span",{style:{"--shiki-light":"#E45649","--shiki-dark":"#E06C75"}},"$PATH"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},":"),s("span",{style:{"--shiki-light":"#E45649","--shiki-dark":"#E06C75"}},"$PostgreSQLPath")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505221509107.png",alt:"image-20250522150936023"})],-1),s("p",null,"查看效果：",-1),s("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#0184BC","--shiki-dark":"#56B6C2"}},"source"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ～/.zshrc")]),e(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#0184BC","--shiki-dark":"#56B6C2"}},"which"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," psql")]),e(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"psql"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," --version")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505221510038.png",alt:"image-20250522151038948"})],-1),s("hr",null,null,-1),s("p",null,"官网推荐 UI 操作工具",-1),s("ul",null,[s("li",null,[s("a",{href:"https://apps.apple.com/us/app/postico-2/id6446933691?mt=12",target:"_blank",rel:"noopener noreferrer"},"postico")]),s("li",null,[s("a",{href:"https://www.pgadmin.org/",target:"_blank",rel:"noopener noreferrer"},"pgadmin")])],-1),s("hr",null,null,-1)])),tab2:i(({value:l,isActive:a})=>t[5]||(t[5]=[s("p",null,[e("在 "),s("a",{href:"https://www.postgresql.org/download/windows/",target:"_blank",rel:"noopener noreferrer"},"PostgreSQL: Windows installers"),e(" 下载安装包")],-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230735147.png",alt:"image-20250523073450134"})],-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230735294.png",alt:"image-20250523073536166"})],-1),s("p",null,"运行安装程序进行安装",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230739803.png",alt:"image-20250523073907756"})],-1),s("p",null,"选择安装目录:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230740574.png",alt:"image-20250523074038536"})],-1),s("p",null,"选择安装组件:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230741259.png",alt:"image-20250523074111219"})],-1),s("ul",null,[s("li",null,[s("p",null,[s("strong",null,"PostgreSQL Server"),e(": PostgreSQL 数据库的核心组件。它包含了实际的数据库服务器软件，负责存储数据、处理查询请求以及管理数据库的运行。没有这个组件，你就无法创建和使用 PostgreSQL 数据库。")])]),s("li",null,[s("p",null,[s("strong",null,"pgAdmin 4"),e(": 图形化的 PostgreSQL 管理和开发平台。它提供了一个用户友好的界面，用于连接数据库服务器、执行 SQL 查询、管理数据库对象（如表、视图、用户等）、监控服务器状态以及进行其他管理任务。类似于 Navicat、DBeaver，但它是 PostgreSQL 官方推荐的")])]),s("li",null,[s("p",null,[s("strong",null,"Stack Builder"),e(": 这是一个可选的工具，用于在 PostgreSQL 安装完成后下载和安装额外的驱动程序、工具和应用程序。例如，你可以用它来安装 PostGIS（地理空间数据扩展）、特定的数据库连接器（如 ODBC 或 JDBC 驱动）或其他有用的 PostgreSQL 相关软件。")])]),s("li",null,[s("p",null,[s("strong",null,"Command Line Tools"),e(": 这包含了 PostgreSQL 的命令行工具集，其中最常用的是 "),s("code",null,"psql"),e("。"),s("code",null,"psql"),e(" 是一个交互式的 PostgreSQL 终端，允许你通过命令行连接到数据库、执行 SQL 命令、管理数据库等。")]),s("table",null,[s("thead",null,[s("tr",null,[s("th",{style:{"text-align":"center"}},"命令"),s("th",{style:{"text-align":"center"}},"用途说明")])]),s("tbody",null,[s("tr",null,[s("td",{style:{"text-align":"center"}},[s("code",null,"psql")]),s("td",{style:{"text-align":"center"}},"PostgreSQL 的命令行客户端，最常用")]),s("tr",null,[s("td",{style:{"text-align":"center"}},[s("code",null,"createdb")]),s("td",{style:{"text-align":"center"}},"创建数据库")]),s("tr",null,[s("td",{style:{"text-align":"center"}},[s("code",null,"dropdb")]),s("td",{style:{"text-align":"center"}},"删除数据库")]),s("tr",null,[s("td",{style:{"text-align":"center"}},[s("code",null,"pg_dump")]),s("td",{style:{"text-align":"center"}},"备份数据库")]),s("tr",null,[s("td",{style:{"text-align":"center"}},[s("code",null,"pg_restore")]),s("td",{style:{"text-align":"center"}},"恢复数据库备份")]),s("tr",null,[s("td",{style:{"text-align":"center"}},[s("code",null,"pg_ctl")]),s("td",{style:{"text-align":"center"}},"控制 PostgreSQL 服务启动/停止等")])])])])],-1),s("p",null,"选择数据目录这里最好还是单独设置,默认会放在系统盘下面:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230742830.png",alt:"image-20250523074245792"})],-1),s("p",null,"设置 postgres 用户密码:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230743951.png",alt:"image-20250523074323910"})],-1),s("p",null,"PostgreSQL 监听端口:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230744950.png",alt:"image-20250523074456908"})],-1),s("p",null,"语言这里不太清楚具体指什么,先保持默认了:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230745260.png",alt:"image-20250523074538224"})],-1),s("p",null,"安装概述:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230747237.png",alt:"image-20250523074727197"})],-1),s("p",null,"安装确认:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230747778.png",alt:"image-20250523074752737"})],-1),s("p",null,"进行安装:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230748812.png",alt:"image-20250523074814767"})],-1),s("p",null,"安装完成确认:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230752669.png",alt:"image-20250523075208616"})],-1),s("p",null,"可选项(Stack Builder):",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230752789.png",alt:"image-20250523075249747"})],-1),s("p",null,"看了下没设么特别需要装的, 略过了:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230753503.png",alt:"image-20250523075326457"})],-1),s("table",null,[s("thead",null,[s("tr",null,[s("th",{style:{"text-align":"center"}},"类别名称"),s("th",{style:{"text-align":"center"}},"中文解释"),s("th",{style:{"text-align":"center"}},"适合人群"),s("th",{style:{"text-align":"center"}},"说明")])]),s("tbody",null,[s("tr",null,[s("td",{style:{"text-align":"center"}},[s("strong",null,"Add-ons, tools and utilities")]),s("td",{style:{"text-align":"center"}},"附加组件、实用工具"),s("td",{style:{"text-align":"center"}},"高级用户 / 运维"),s("td",{style:{"text-align":"center"}},[e("包括性能监控工具、日志分析器、管理脚本等。常见的如："),s("code",null,"pgBouncer"),e("（连接池）、"),s("code",null,"pgAgent"),e("（任务调度器）。")])]),s("tr",null,[s("td",{style:{"text-align":"center"}},[s("strong",null,"Database Drivers")]),s("td",{style:{"text-align":"center"}},"数据库驱动"),s("td",{style:{"text-align":"center"}},"开发者"),s("td",{style:{"text-align":"center"}},"如果你用 Java、ODBC、.NET 等语言访问 PostgreSQL，可以在这里安装对应驱动（如 JDBC、ODBC）。")]),s("tr",null,[s("td",{style:{"text-align":"center"}},[s("strong",null,"Database Server")]),s("td",{style:{"text-align":"center"}},"数据库服务器"),s("td",{style:{"text-align":"center"}},"特殊部署场景"),s("td",{style:{"text-align":"center"}},"用于安装其他版本或多实例 PostgreSQL，有时也包括一些兼容组件。")]),s("tr",null,[s("td",{style:{"text-align":"center"}},[s("strong",null,"Registration-required and trial products")]),s("td",{style:{"text-align":"center"}},"需要注册或试用的产品"),s("td",{style:{"text-align":"center"}},"企业用户"),s("td",{style:{"text-align":"center"}},"这里包括一些商业插件或试用版工具，如备份工具、可视化 BI 工具等。多数不是免费开源的。")]),s("tr",null,[s("td",{style:{"text-align":"center"}},[s("strong",null,"Spatial Extensions")]),s("td",{style:{"text-align":"center"}},"空间扩展（GIS）"),s("td",{style:{"text-align":"center"}},"地理信息系统开发者"),s("td",{style:{"text-align":"center"}},[e("例如安装 "),s("strong",null,"PostGIS"),e(" —— 这是 PostgreSQL 最有名的插件之一，用于存储和查询地理空间数据（地图、地块等）。")])]),s("tr",null,[s("td",{style:{"text-align":"center"}},[s("strong",null,"Web Development")]),s("td",{style:{"text-align":"center"}},"Web开发插件"),s("td",{style:{"text-align":"center"}},"Web 开发者"),s("td",{style:{"text-align":"center"}},"提供如 Apache/PHP/PostgreSQL 一体化环境等组件，帮助你构建 Web 服务环境。")])])],-1),s("hr",null,null,-1),s("p",null,[e("PostgreSQL 安装完成后会在 "),s("code",null,"services.msc"),e(" 中看到服务:")],-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230757559.png",alt:"image-20250523075755511"})],-1),s("p",null,"可以打开 pgAdmin 看看",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230759325.png",alt:"image-20250523075925256"})],-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230800991.png",alt:"image-20250523080044921"})],-1),s("p",null,"接下来需要添加 PostgreSQL 命令行工具目录到系统PATH以便后续在命令行中使用psql等命令:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230804156.png",alt:"image-20250523080404090"})],-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230805610.png",alt:"image-20250523080525552"})],-1),s("p",null,"重启命令行后可以看到 psql 已经可用了:",-1),s("p",null,[s("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202505230805112.png",alt:"image-20250523080555068"})],-1)])),_:1}),t[7]||(t[7]=n(`<hr><h2 id="设置远程访问" tabindex="-1"><a class="header-anchor" href="#设置远程访问"><span>设置远程访问</span></a></h2><p>在PostgreSQL服务器上，打开配置文件<code>postgresql.conf</code>，通常于<code>/etc/postgresql/{version}/main/postgresql.conf</code></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">find</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postgresql.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202404081653095.png" alt="image-20240408165346376"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202404081656674.png" alt="image-20240408165614574"></p><p>可以使用 <code>*</code> 来匹配所有的 IP, 亦可以指定监听的网卡 IP (本机网卡IP)列表, 例如:</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">listen_addresses</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;localhost,192.168.1.100&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后编辑同级目录下的 <code>pg_hba.conf</code> 来设置允许连接到此数据库的 IP 段</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202404081710795.png" alt="image-20240408171001717"></p><p>例如</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># IPv4 local connections:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">host    all             all             192.168.1.0/24            scram-sha-256</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">host    all             all             10.0.0.0/24               scram-sha-256</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看当前的用户列表:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postgres</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> psql</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\du</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202404081714323.png" alt="image-20240408171416256"></p><p>可以使用如下命令修改 <code>postgres</code> 用户的密码为 <code>new_password</code></p><div class="language-postgresql line-numbers-mode" data-highlighter="shiki" data-ext="postgresql" data-title="postgresql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>ALTER USER postgres PASSWORD &#39;new_password&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202404081717005.png" alt="image-20240408171721932"></p><p>完成上述配置后重启 Postgres</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postgresql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>之后就可以正常通过配置的 <code>listen_address</code> 以及 Postgres 端口通过允许连接的 host IP 段的主机连接到 Postgres 数据库了</p><blockquote><p>不需要考虑 md5 或是 scram-sha-256 的密码加密方案, 在使用数据库管理工具连接 Postgres 的时候会自动协商</p></blockquote><p><img src="http://cdn.ayusummer233.top/DailyNotes/202404081741964.png" alt="image-20240408174158805"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202404081742654.png" alt="image-20240408174213587"></p><hr><h2 id="基础操作" tabindex="-1"><a class="header-anchor" href="#基础操作"><span>基础操作</span></a></h2><div class="language-postgresql line-numbers-mode" data-highlighter="shiki" data-ext="postgresql" data-title="postgresql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>-- 创建数据库 mydatabase</span></span>
<span class="line"><span>CREATE DATABASE mydatabase;</span></span>
<span class="line"><span>--- 将 mydatabase 修改为 samplea</span></span>
<span class="line"><span>ALTER DATABASE mydatabase RENAME TO sample;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="sqlalchemy操作" tabindex="-1"><a class="header-anchor" href="#sqlalchemy操作"><span>sqlalchemy操作</span></a></h2><p>除了需要安装 SQLAlchemy 外还需要安装 psycopg2 库(PostgreSQL 数据库适配器), 它允许 Python 应用程序与 PostgreSQL 数据库进行交互</p><p>在安装 psycopg2 库前需要先安装 PostgreSQL 客户端库:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libpq-dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后再安装 psycopg2</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> psycopg2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="数据库同步" tabindex="-1"><a class="header-anchor" href="#数据库同步"><span>数据库同步</span></a></h2><ul><li><strong>流复制（Streaming Replication）</strong>：配置 PostgreSQL 流复制，将源数据库设置为主服务器（Primary），目标数据库设置为从服务器（Standby），然后使用流复制将数据同步到目标数据库。这种方法可以保持数据的实时同步，并且不会产生不必要的网络流量。</li><li><strong>逻辑复制（Logical Replication）</strong>：逻辑复制允许你只复制感兴趣的表或数据，而不是整个数据库。你可以设置逻辑复制订阅，并选择要复制的表，以减少不必要的数据传输。</li></ul><hr><h3 id="逻辑复制" tabindex="-1"><a class="header-anchor" href="#逻辑复制"><span>逻辑复制</span></a></h3><p>在 Postgre 中, 要使用逻辑复制, 需要确保 <code>wal_level</code> 至少为 <code>logical</code>, 这样 PostgreSQL 才能生成逻辑复制所需的 WAL 日志</p><blockquote><p>WAL 日志(Write-Ahead Logging)是数据库系统中的一种技术, 用于确保数据持久性和事务的原子性</p><p>WAL 日志记录了数据库中发生的所有变更操作, 例如插入, 更新和删除操作, 以及相关的事务信息</p></blockquote><p>修改 <code>postgresql.conf</code> 中的 <code>wal_level</code> 设置为 <code>logical</code> 即可:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202404091557518.png" alt="image-20240409155715278"></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重启 PostgreSQL</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postgresql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>主数据库创建逻辑复制源:</p><div class="language-postgresql line-numbers-mode" data-highlighter="shiki" data-ext="postgresql" data-title="postgresql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>-- 连接到目标数据库</span></span>
<span class="line"><span>\\c my_database</span></span>
<span class="line"><span>-- 创建逻辑订阅</span></span>
<span class="line"><span>CREATE PUBLICATION my_pub FOR TABLE my_table;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在从数据库中设置逻辑复制订阅</p><div class="language-postgresql line-numbers-mode" data-highlighter="shiki" data-ext="postgresql" data-title="postgresql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>-- 创建逻辑复制订阅</span></span>
<span class="line"><span>CREATE SUBSCRIPTION my_sub CONNECTION &#39;dbname=my_db host=xx.xx.xx.xx port=5432 user=postgres password=xxx&#39; PUBLICATION my_pub;</span></span>
<span class="line"><span>-- 启用订阅</span></span>
<span class="line"><span>ALTER SUBSCRIPTION my_sub ENABLE;</span></span>
<span class="line"><span>-- 关闭订阅</span></span>
<span class="line"><span>ALTER SUBSCRIPTION my_sub DISABLE;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>`,49))])}const b=p(c,[["render",u],["__file","PostgreSQL.html.vue"]]),A=JSON.parse('{"path":"/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/PostgreSQL.html","title":"PostgreSQL","lang":"zh-CN","frontmatter":{"category":"后端","tags":["数据库","PostgreSQL"],"excerpt":"PostgreSQL 是一个开源的关系型数据库管理系统（RDBMS），功能强大、稳定可靠，被广泛应用于Web开发、数据分析、GIS、金融、电商等各种场景。","description":"PostgreSQL PostgreSQL 安装 设置远程访问 基础操作 sqlalchemy操作 数据库同步 逻辑复制 安装 设置远程访问 在PostgreSQL服务器上，打开配置文件postgresql.conf，通常于/etc/postgresql/{version}/main/postgresql.conf image-202404081653...","head":[["meta",{"property":"og:url","content":"https://233official.github.io/dailynotes/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/PostgreSQL.html"}],["meta",{"property":"og:site_name","content":"DailyNotes"}],["meta",{"property":"og:title","content":"PostgreSQL"}],["meta",{"property":"og:description","content":"PostgreSQL PostgreSQL 安装 设置远程访问 基础操作 sqlalchemy操作 数据库同步 逻辑复制 安装 设置远程访问 在PostgreSQL服务器上，打开配置文件postgresql.conf，通常于/etc/postgresql/{version}/main/postgresql.conf image-202404081653..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"http://cdn.ayusummer233.top/DailyNotes/202404081648820.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-05-29T18:08:09.000Z"}],["meta",{"property":"article:tag","content":"数据库"}],["meta",{"property":"article:tag","content":"PostgreSQL"}],["meta",{"property":"article:modified_time","content":"2025-05-29T18:08:09.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"PostgreSQL\\",\\"image\\":[\\"http://cdn.ayusummer233.top/DailyNotes/202404081648820.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505221458053.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505221459599.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505221500162.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505221500970.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505221509107.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505221510038.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230735147.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230735294.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230739803.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230740574.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230741259.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230742830.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230743951.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230744950.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230745260.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230747237.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230747778.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230748812.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230752669.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230752789.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230753503.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230757559.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230759325.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230800991.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230804156.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230805610.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202505230805112.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202404081653095.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202404081656674.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202404081710795.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202404081714323.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202404081717005.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202404081741964.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202404081742654.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202404091557518.png\\"],\\"dateModified\\":\\"2025-05-29T18:08:09.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"咸鱼型233\\",\\"url\\":\\"https://233official.github.io/dailynotes/\\"}]}"]],"date":"2024-04-11T09:41:58.000Z"},"headers":[{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":2,"title":"设置远程访问","slug":"设置远程访问","link":"#设置远程访问","children":[]},{"level":2,"title":"基础操作","slug":"基础操作","link":"#基础操作","children":[]},{"level":2,"title":"sqlalchemy操作","slug":"sqlalchemy操作","link":"#sqlalchemy操作","children":[]},{"level":2,"title":"数据库同步","slug":"数据库同步","link":"#数据库同步","children":[{"level":3,"title":"逻辑复制","slug":"逻辑复制","link":"#逻辑复制","children":[]}]}],"git":{"createdTime":1712828518000,"updatedTime":1748542089000,"contributors":[{"name":"233PC","username":"233PC","email":"ayusummer233@vip.qq.com","commits":2,"url":"https://github.com/233PC"},{"name":"233Mac","username":"233Mac","email":"ayusummer233@vip.qq.com","commits":3,"url":"https://github.com/233Mac"},{"name":"Ayusummer","username":"Ayusummer","email":"ayusummer233@gmail.com","commits":1,"url":"https://github.com/Ayusummer"}]},"readingTime":{"minutes":7.21,"words":2163},"filePathRelative":"后端/数据库/PostgreSQL.md","localizedDate":"2024年4月11日","autoDesc":true}');export{b as comp,A as data};
